webpackJsonp([38],{Ceih:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("Xxa5"),o=r.n(a),n=r("exGp"),i=r.n(n),s=r("RRo+"),l=r.n(s),u=r("Dd8w"),m=r.n(u),p=r("NYxO"),c=r("vU3h"),d=r("5Vl1"),f={components:{PonitTo:c.a,UploadImg:d.a},computed:m()({},Object(p.b)({}),{isEdit:function(){return"edit"==this.$route.meta.type},isBasicTemplate:function(){return 1==this.ruleForm.type},isFreeShow:function(){return!this.isBasicTemplate}}),watch:{},data:function(){return{ruleForm:{name:"",time:[],is_free:"1",template:"1",type:"1",show_num:3,point:[{to_type:"2",to_value:"",to_img:"",resolution:""}],sort:""},rules:{time:[{type:"array",required:!0,message:"请选择有效期",trigger:"change"}],sort:[{validator:function(e,t,r){t||t+""=="0"||r(new Error("序号不能为空")),setTimeout(function(){l()(Number(t))?r():r(new Error("请输入数字值"))},1e3)},trigger:"blur"}],show_num:[{validator:function(e,t,r){t||t+""=="0"||r(new Error("数量不能为空")),setTimeout(function(){l()(Number(t))?Number(t)<3?r(new Error("数量不能小于3")):r():r(new Error("请输入数字值"))},1e3)},trigger:"blur"}]}}},created:function(){this.isEdit&&this.getSecondTemplateInfo(this.$route.params.id)},methods:{getResolutionFn:function(e,t){this.ruleForm.point[e].resolution=t},deleteTemplateFn:function(e){this.ruleForm.point.splice(e,1)},changeTemplateTypeFn:function(e){this.ruleForm.show_num=1==e?"":3,this.ruleForm.point=[{to_type:"1",to_value:"",to_img:"",resolution:""}]},addTemplateFn:function(){this.ruleForm.point.push({to_type:"1",to_value:"",to_img:"",resolution:""})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var r=t._.cloneDeep(t.ruleForm);r.start_time=r.time[0],r.end_time=r.time[1],r.level="2",r.second_id=t.$route.params.cid,delete r.time;var a=!0;if(1==r.type)for(var o=r.point.length,n=0;n<o;n++){var i=r.point[n];if((1==i.to_type||4==i.to_type||6==i.to_type)&&""==i.to_value){t.$message({duration:1500,message:"请输入正确的指向目标",type:"warning"}),a=!1;break}if(""==i.to_img){t.$message({duration:1500,message:"请上传图片",type:"warning"}),a=!1;break}2!=i.to_type&&3!=i.to_type&&7!=i.to_type||delete i.to_value}else delete r.point;a&&(t.isEdit?(r.id=t.$route.params.id,t.putSecondTemplateUpdateFn(r)):t.putSecondTemplateAddFn(r))})},resetForm:function(e){this.$refs[e].resetFields()},goBackFn:function(){this.resetForm("ruleForm"),this.$router.push("/operationManage/second/info/"+this.$route.params.cid)},putSecondTemplateUpdateFn:function(){var e=i()(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("putSecondTemplateUpdate",t);case 2:200==e.sent.code&&(this.$message({duration:1500,message:"修改成功",type:"success"}),this.goBackFn());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),putSecondTemplateAddFn:function(){var e=i()(o.a.mark(function e(t){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("putSecondTemplateAdd",t);case 2:200==e.sent.code&&(this.$message({duration:1500,message:"添加成功",type:"success"}),this.goBackFn());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getSecondTemplateInfo:function(){var e=i()(o.a.mark(function e(t){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("getSecondTemplateInfo",{id:t});case 2:200==(r=e.sent).code&&(this.ruleForm={time:[r.data.start_time,r.data.end_time],sort:r.data.sort,name:r.data.name,point:r.data.point?r.data.point:[],is_free:r.data.is_free+"",template:r.data.template+"",type:r.data.type+"",show_num:r.data.show_num||3});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},_={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container clearfix"},[r("div",{staticClass:"float-left",staticStyle:{width:"650px"}},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"模板名称",prop:"name",rules:[{required:!0,message:"请输入模板名称",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字符",trigger:"blur"}]}},[r("el-input",{attrs:{placeholder:"请输入模板名称（10字以内）"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"模板类型"}},[r("el-radio-group",{on:{change:e.changeTemplateTypeFn},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[r("el-radio",{attrs:{label:"1"}},[e._v("基础模板")]),e._v(" "),r("el-radio",{attrs:{label:"2"}},[e._v("功能模板")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"模板样式"}},[r("el-radio-group",{model:{value:e.ruleForm.template,callback:function(t){e.$set(e.ruleForm,"template",t)},expression:"ruleForm.template"}},[r("el-radio",{attrs:{label:"1"}},[e._v("模板1")]),e._v(" "),r("el-radio",{attrs:{label:"2"}},[e._v("模板2")]),e._v(" "),r("el-radio",{attrs:{label:"3"}},[e._v("模板3")]),e._v(" "),r("el-radio",{attrs:{label:"4"}},[e._v("模板4")]),e._v(" "),r("el-radio",{attrs:{label:"5"}},[e._v("模板5")])],1)],1),e._v(" "),e.isBasicTemplate?e._e():r("el-form-item",{attrs:{label:"显示书籍数",prop:"show_num"}},[r("el-input",{attrs:{placeholder:"请输入模板显示书籍数量"},model:{value:e.ruleForm.show_num,callback:function(t){e.$set(e.ruleForm,"show_num",t)},expression:"ruleForm.show_num"}})],1),e._v(" "),e._l(e.ruleForm.point,function(t,a){return e.isBasicTemplate?r("div",{key:a,class:e.isBasicTemplate?"basic-wrapper":""},[r("div",{staticClass:"point"},[r("el-form-item",{attrs:{label:"上传图片",required:""}},[r("upload-img",{attrs:{picture:t.to_img},on:{"update:picture":function(r){e.$set(t,"to_img",r)},getResolution:function(t){e.getResolutionFn(a,t)}}},[e._v("支持JPG、BMP、PNG、建议尺寸 750*299PX")])],1),e._v(" "),r("ponit-to",{attrs:{"to-type":t.to_type,"to-value":t.to_value,type:[1,2,3,4,6,7]},on:{"update:toType":function(r){e.$set(t,"to_type",r)},"update:toValue":function(r){e.$set(t,"to_value",r)}}})],1),e._v(" "),a>0?r("div",{staticClass:"delete"},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.deleteTemplateFn(a)}}},[e._v("删除")])],1):e._e()]):e._e()}),e._v(" "),e.isFreeShow?r("el-form-item",{attrs:{label:"是否免费"}},[r("el-radio-group",{model:{value:e.ruleForm.is_free,callback:function(t){e.$set(e.ruleForm,"is_free",t)},expression:"ruleForm.is_free"}},[r("el-radio",{attrs:{label:"1"}},[e._v("是")]),e._v(" "),r("el-radio",{attrs:{label:"2"}},[e._v("否")])],1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"排序",prop:"sort",required:""}},[r("el-input",{model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"有效期",prop:"time"}},[r("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.ruleForm.time,callback:function(t){e.$set(e.ruleForm,"time",t)},expression:"ruleForm.time"}})],1),e._v(" "),r("el-form-item",[r("el-button",{on:{click:function(t){e.goBackFn()}}},[e._v("返回")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")]),e._v(" "),e.isBasicTemplate?r("el-button",{attrs:{type:"warning"},on:{click:e.addTemplateFn}},[e._v("添加模板样式")]):e._e()],1)],2)],1),e._v(" "),r("div",{staticClass:"float-left",staticStyle:{"margin-left":"50px"}},[r("h3",{staticStyle:{"margin-top":"0"}},[e._v("模板预览")]),e._v(" "),r("div",{staticStyle:{width:"400px"}},[e.isBasicTemplate?r("img",{staticStyle:{width:"100%"},attrs:{src:"/static/template/b"+e.ruleForm.template+".png",alt:""}}):r("img",{staticStyle:{width:"100%"},attrs:{src:"/static/template/"+e.ruleForm.template+".png",alt:""}})])])])},staticRenderFns:[]};var v=r("VU/8")(f,_,!1,function(e){r("sKmN")},"data-v-411c67be",null);t.default=v.exports},FSCw:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,"\n.basic-wrapper[data-v-411c67be] {\r\n  position: relative;\r\n  border: 1px solid #000;\r\n  margin-bottom: 10px;\n}\n.basic-wrapper .point[data-v-411c67be] {\r\n  width: 90%;\n}\n.basic-wrapper .el-form-item[data-v-411c67be] {\r\n  margin-top: 10px;\n}\n.delete[data-v-411c67be] {\r\n  position: absolute;\r\n  top: 50%;\r\n  -webkit-transform: translate(100%, -50%);\r\n          transform: translate(100%, -50%);\r\n  right: -10px;\n}\r\n",""])},sKmN:function(e,t,r){var a=r("FSCw");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r("rjj0")("ff774c56",a,!0)}});