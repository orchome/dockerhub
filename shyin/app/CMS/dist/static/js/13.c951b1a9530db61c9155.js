webpackJsonp([13],{J5Gm:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.el-tag + .el-tag {\r\n  margin-left: 10px;\n}\n.button-new-tag {\r\n  margin-left: 10px;\r\n  height: 24px;\r\n  line-height: 22px;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\n}\n.input-new-tag {\r\n  width: 90px;\r\n  margin-left: 10px;\r\n  vertical-align: bottom;\n}\n.pic-wrap {\r\n  height: 560px;\r\n  overflow-y: scroll;\r\n  font-size: 0;\n}\n.pic-wrap > .pic {\r\n  width: 25%;\r\n  margin-bottom: 5px;\n}\n.pic-wrap > .pic > img {\r\n  width: 190px;\r\n  height: 105px;\n}\n.dialogPic .el-dialog__body {\r\n  padding-bottom: 0;\n}\r\n/* 美化webkit内核滚动条 */\n::-webkit-scrollbar {\r\n  width: 8px;\r\n  height: 8px;\n}\n::-webkit-scrollbar-thumb {\r\n  background-color: #777;\n}\n.spinner-wrap {\r\n  display: -webkit-box;\r\n  display: -ms-flexbox;\r\n  display: flex;\r\n  -webkit-box-align: center;\r\n      -ms-flex-align: center;\r\n          align-items: center;\r\n  font-size: 14px;\r\n  -webkit-box-pack: center;\r\n      -ms-flex-pack: center;\r\n          justify-content: center;\n}\n.img-wrap {\r\n  margin-top: 10px;\r\n  width: 360px;\r\n  height: 200px;\n}\n.img-wrap img {\r\n  width: 100%;\r\n  height: 100%;\n}\r\n",""])},PgMr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("lHA8"),a=i.n(r),n=i("c/Tr"),o=i.n(n),l=i("Xxa5"),s=i.n(l),c=i("exGp"),u=i.n(c),d=i("Dd8w"),p=i.n(d),h=i("NYxO"),m={computed:p()({isEdit:function(){return this.$route.fullPath.indexOf("/edit/")>-1}},Object(h.b)({cpsBook:"cpsBook",cpsKeywordPic:"cpsKeywordPic"})),watch:{},data:function(){return{dialogVisible:!1,allActiveLink:[],inputVisible:!1,inputValue:"",allVolume:[],options:[],optionsChapter:[],loadingBut:!1,loading:!1,loadingChapter:!1,load:!1,loadingKeywordPic:!1,optionsKeywordPic:[],ruleForm:{id:"",book_id:"",chapter_id:"",title_material_id:"",activity_id:"",precision:"0",keywords:[],pic:"",type:"0",album_id:""},rules:{keywords:[{type:"array",required:!0,message:"请至少输入一个关键词",trigger:"blur"}],book_id:[{required:!0,message:"请选择小说",trigger:"change"}],chapter_id:[{required:!0,message:"请选择章节",trigger:"change"}],activity_id:[{required:!0,message:"请选择活动链接",trigger:"change"}],title_material_id:[{required:!0,message:"请选择活动标题",trigger:"change"}],pic:[{required:!0,message:"请选择活动头图",trigger:"change"}]},allChapter:[],page:0,allMaterialPic:{data:[],total:0,last_page:1,current_page:0},pictureUrl:""}},methods:{remoteMethod:function(t){var e=this;""!==t?(this.loading=!0,setTimeout(function(){e.loading=!1,e.options=e.cpsBook.filter(function(e){return e.id.indexOf(t)>-1||e.name.indexOf(t)>-1})},200)):this.options=[]},remoteMethodChapter:function(t){var e=this;""!==t?(this.loadingChapter=!0,setTimeout(function(){e.loadingChapter=!1,e.optionsChapter=e.allChapter.filter(function(e){return e.id=e.id+"",e.id.indexOf(t)>-1||e.name.indexOf(t)>-1})},200)):this.optionsChapter=[]},remoteMethodAlbum:function(t){var e=this;""!==t?(this.loadingKeywordPic=!0,setTimeout(function(){e.loadingKeywordPic=!1,e.optionsKeywordPic=e.cpsKeywordPic.filter(function(e){return e.id=e.id+"",e.id.indexOf(t)>-1||e.title.indexOf(t)>-1})},200)):this.optionsKeywordPic=[]},getCPSShowAllChapterFn:function(){var t=u()(s.a.mark(function t(e){var i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e+"")){t.next=5;break}return t.next=3,this.$store.dispatch("getCPSShowAllChapter",{book_id:e});case 3:200==(i=t.sent).code&&(this.allChapter=i.data);case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return e.loadingBut=!1,!1;e.loadingBut=!0;var i=e._.cloneDeep(e.ruleForm),r=o()(new a.a(i.keywords));i.keywords=r.toString(),e.isEdit?e.postCPSKeywordUpdateFn(i):e.postCPSKeywordCreateFn(i)})},resetForm:function(t){this.$refs[t].resetFields()},closeForm:function(t){this.$refs[t].resetFields(),this.closeSelectedTag("/CPSManage/push/keywords")},postCPSKeywordCreateFn:function(){var t=u()(s.a.mark(function t(e){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("postCPSKeywordCreate",e);case 2:200==t.sent.code&&(this.$message({duration:1500,message:"添加关键词回复成功！",type:"success"}),this.$router.push("/CPSManage/push/keywords")),this.loadingBut=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),postCPSKeywordUpdateFn:function(){var t=u()(s.a.mark(function t(e){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("postCPSKeywordUpdate",e);case 2:200==t.sent.code&&(this.$message({duration:1500,message:"修改关键词回复成功！",type:"success"}),this.$router.push("/CPSManage/push/keywords")),this.loadingBut=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),handleClose:function(t){this.ruleForm.keywords.splice(t,1)},getCPSKeywordInfoFn:function(){var t=u()(s.a.mark(function t(e){var i,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("getCPSKeywordInfo",{id:e});case 2:if(200!=(i=t.sent).code){t.next=18;break}if(1!=i.data.type){t.next=9;break}this.getCPSMaterialPicFn(),this.pictureUrl="http://res.shiyin.net/"+i.data.pic,t.next=17;break;case 9:if(2!=i.data.type){t.next=13;break}this.optionsKeywordPic=[this.cpsKeywordPic.find(function(t){return t.id==i.data.album_id})],t.next=17;break;case 13:return this.remoteMethod(i.data.book_id),t.next=16,this.getCPSShowAllChapterFn(i.data.book_id);case 16:this.remoteMethodChapter(i.data.chapter_id);case 17:for(r in this.ruleForm)this.ruleForm[r]="keywords"==r?i.data[r].split(","):i.data[r];case 18:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick(function(){t.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this.inputValue;t&&this.ruleForm.keywords.push(t),this.inputVisible=!1,this.inputValue=""},getCPSMaterialPicFn:function(){var t=u()(s.a.mark(function t(){var e,i,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.load=!0,e=this.page,t.next=4,this.$store.dispatch("getCPSMaterialPic",{page:this.page+1});case 4:200==(i=t.sent).code?(r=[],r=1!=i.data.current_page?this.allMaterialPic.data.concat(i.data.data):i.data.data,this.allMaterialPic={data:r,total:i.data.total,last_page:i.data.last_page,current_page:i.data.current_page},this.page=i.data.current_page):this.page=e,this.load=!1;case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),selectPictureFn:function(t,e){this.ruleForm.pic=t,this.pictureUrl=e,this.dialogVisible=!1},getCPSGetActiveFn:function(){var t=u()(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("getCPSGetActive");case 2:200==(e=t.sent).code&&(e.data.map(function(t){return t.id=t.id+""}),this.allActiveLink=e.data);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getCPSGetTitleFn:function(){var t=u()(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("getCPSGetTitle");case 2:200==(e=t.sent).code&&(e.data.map(function(t){return t.id=t.id+""}),this.allActivityTitle=e.data);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},created:function(){var t=u()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.getCPSGetActiveFn(),this.getCPSGetTitleFn(),t.next=4,this.$store.dispatch("getCPSBook");case 4:return t.next=6,this.$store.dispatch("getCPSGetPic");case 6:this.isEdit?this.getCPSKeywordInfoFn(this.$route.params.id):this.getCPSMaterialPicFn();case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"关键词",prop:"keywords"}},[t._l(t.ruleForm.keywords,function(e,r){return i("el-tag",{key:r,attrs:{size:"small",closable:"","disable-transitions":!1},on:{close:function(e){t.handleClose(r)}}},[t._v(t._s(e))])}),t._v(" "),t.inputVisible?i("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.handleInputConfirm(e)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):t._e(),t._v(" "),t.inputVisible?t._e():i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 关键词")])],2),t._v(" "),i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"关键词类型"}},[i("el-radio-group",{model:{value:t.ruleForm.precision,callback:function(e){t.$set(t.ruleForm,"precision",e)},expression:"ruleForm.precision"}},[i("el-radio",{attrs:{label:"0"}},[t._v("模糊")]),t._v(" "),i("el-radio",{attrs:{label:"1"}},[t._v("全匹配")])],1)],1),t._v(" "),i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"指向类型"}},[i("el-radio-group",{on:{change:function(e){t.resetForm("ruleForm")}},model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}},[t.isEdit&&"0"==t.ruleForm.type||!t.isEdit?i("el-radio",{attrs:{label:"0"}},[t._v("小说")]):t._e(),t._v(" "),t.isEdit&&"1"==t.ruleForm.type||!t.isEdit?i("el-radio",{attrs:{label:"1"}},[t._v("活动")]):t._e(),t._v(" "),t.isEdit&&"2"==t.ruleForm.type||!t.isEdit?i("el-radio",{attrs:{label:"2"}},[t._v("美女")]):t._e()],1)],1),t._v(" "),2==t.ruleForm.type?i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"相册链接",prop:"album_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入相册名称/相册ID",filterable:"",remote:"","remote-method":t.remoteMethodAlbum,loading:t.loadingKeywordPic},model:{value:t.ruleForm.album_id,callback:function(e){t.$set(t.ruleForm,"album_id",e)},expression:"ruleForm.album_id"}},t._l(t.optionsKeywordPic,function(e){return i("el-option",{key:e.id,attrs:{label:e.title,value:e.id}},[i("span",{staticStyle:{float:"left"}},[t._v(t._s(e.id))]),t._v(" "),i("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.title))])])}))],1):t._e(),t._v(" "),0==t.ruleForm.type?i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"小说名称",prop:"book_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入小说名称/小说ID",filterable:"",remote:"","remote-method":t.remoteMethod,loading:t.loading},on:{change:t.getCPSShowAllChapterFn},model:{value:t.ruleForm.book_id,callback:function(e){t.$set(t.ruleForm,"book_id",e)},expression:"ruleForm.book_id"}},t._l(t.options,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[i("span",{staticStyle:{float:"left"}},[t._v(t._s(e.id))]),t._v(" "),i("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.name))])])}))],1):t._e(),t._v(" "),0==t.ruleForm.type?i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"章节名称",prop:"chapter_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入小说章节名称/章节ID",filterable:"",remote:"","remote-method":t.remoteMethodChapter,loading:t.loadingChapter},model:{value:t.ruleForm.chapter_id,callback:function(e){t.$set(t.ruleForm,"chapter_id",e)},expression:"ruleForm.chapter_id"}},t._l(t.optionsChapter,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[i("span",{staticStyle:{float:"left"}},[t._v(t._s(e.id))]),t._v(" "),i("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.name))])])}))],1):t._e(),t._v(" "),1==t.ruleForm.type?i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"活动链接",prop:"activity_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择活动链接"},model:{value:t.ruleForm.activity_id,callback:function(e){t.$set(t.ruleForm,"activity_id",e)},expression:"ruleForm.activity_id"}},t._l(t.allActiveLink,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1):t._e(),t._v(" "),1==t.ruleForm.type?i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"活动标题",prop:"title_material_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择活动标题"},model:{value:t.ruleForm.title_material_id,callback:function(e){t.$set(t.ruleForm,"title_material_id",e)},expression:"ruleForm.title_material_id"}},t._l(t.allActivityTitle,function(t){return i("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}))],1):t._e(),t._v(" "),1==t.ruleForm.type?i("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"活动头图",prop:"pic"}},[i("el-button",{on:{click:function(e){t.dialogVisible=!0}}},[t._v("点击选择图片")]),t._v(" "),t.pictureUrl?i("div",{staticClass:"img-wrap"},[i("img",{attrs:{src:t.pictureUrl,alt:""}})]):t._e(),t._v(" "),i("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{disabled:""},model:{value:t.ruleForm.pic,callback:function(e){t.$set(t.ruleForm,"pic",e)},expression:"ruleForm.pic"}})],1):t._e(),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary",loading:t.loadingBut},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")]),t._v(" "),i("el-button",{on:{click:function(e){t.closeForm("ruleForm")}}},[t._v("返回")])],1)],1)],1),t._v(" "),i("el-dialog",{staticClass:"dialogPic",attrs:{title:"选择活动头图(双击选中图片)",visible:t.dialogVisible,width:"820px","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"pic-wrap clearfix"},t._l(t.allMaterialPic.data,function(e){return i("div",{key:e.id,staticClass:"float-left pic",attrs:{center:""}},[i("img",{attrs:{src:e._pic,alt:""},on:{dblclick:function(i){t.selectPictureFn(e.pic,e._pic)}}})])})),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("div",{staticClass:"spinner-wrap"},[t.allMaterialPic.last_page==t.allMaterialPic.current_page?i("span",[t._v("全部加载完毕")]):i("el-button",{attrs:{type:"primary",loading:t.load},on:{click:function(e){t.getCPSMaterialPicFn()}}},[t._v(t._s(t.load?"加载中":" 点击加载"))])],1)])])],1)},staticRenderFns:[]};var g=i("VU/8")(m,f,!1,function(t){i("bJKK")},null,null);e.default=g.exports},bJKK:function(t,e,i){var r=i("J5Gm");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);i("rjj0")("1aeef0f0",r,!0)}});