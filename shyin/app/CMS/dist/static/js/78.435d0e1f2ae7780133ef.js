webpackJsonp([78],{"1QNQ":function(n,e,t){var a=t("FwZ3");"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);t("rjj0")("619e9e2d",a,!0)},FwZ3:function(n,e,t){(n.exports=t("FZ+f")(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},mfWo:function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=t("mvHQ"),s=t.n(a),o=t("Xxa5"),i=t.n(o),l=t("exGp"),r=t.n(l),c=t("lHA8"),u=t.n(c),d=t("c/Tr"),p=t.n(d),h=t("Dd8w"),m=t.n(h),f=t("NYxO"),b=t("TIfe"),g={name:"novelManageNovelList",computed:m()({},Object(f.b)({bookList:"bookList",bookSources:"bookSources",categorySelect:"categorySelect"}),{multipleDeleteVisible:function(){return 0===this.multipleSelect.length},placeholder:function(){return 1==this.radio?"请输入小说ID":"请输入小说名称"}}),watch:{bookUploadVisible:function(n){n||this.$refs.upload.clearFiles()},bookSources:function(n){var e=[{id:"0",name:"全部来源"},{id:"100",name:"十音"}].concat(n.slice());this.sources=e}},data:function(){return{keywords:"",radio:"2",selectedCategoryOptions:[0],bookUploadVisible:!1,searchKey:{category:"0",state:"0",source:"0"},states:[{value:"0",label:"全部状态"},{value:"100",label:"下架"},{value:"1",label:"上架"},{value:"2",label:"审核中"},{value:"3",label:"审核未通过"}],sources:[{id:"0",name:"全部来源"},{id:"100",name:"十音"}],changeStates:[{value:"0",label:"下架"},{value:"1",label:"上架"},{value:"2",label:"审核中"},{value:"3",label:"审核未通过"}],loading:!1,visible2:!1,page:1,size:20,total:20,multipleDelete:!1,multipleSelect:[],params:{orderby:"",orderway:"",cat_id:"",check_status:"",check_img:"",book_id:"",name:"",page:1,role_type:"",admin_id:""},list:[],hidenTXT:!1}},methods:{exportBookFn:function(n){window.open("/admin/download_book?book_id="+n.id+"&name="+n.name+"-"+n._pen_name)},fuzzyQueryFn:function(){this.params.orderby="",this.params.orderway="",this.params.book_id="",this.params.name="",this.params.page=1,1==this.radio?(this.params.book_id=this.keywords,this.params.name=""):(this.params.name=this.keywords,this.params.book_id=""),this.getBookListFn()},changeBookSourceFn:function(n){this.params.check_img=n,this.params.page=1,this.getBookListFn()},changeBookStatusFn:function(n){this.params.check_status=n,this.params.page=1,this.getBookListFn()},changeBookCategoryFn:function(n){this.params.cat_id=Number(n[n.length-1]),this.params.page=1,this.getBookListFn()},handleCommand:function(n,e){var t=this;"edit"==e?this.$router.push("/novelManage/novel/edit/"+n.id):"delete"==e?this.$confirm("此操作将永久删除该小说, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$store.dispatch("deleteBookDel",{book_id:n.id}).then(function(n){200==n.code&&(t.$message({type:"success",message:"删除成功!"}),t.getBookListFn())}).catch(function(){})}).catch(function(){}):"export"==e&&this.exportBookFn(n)},submitUpload:function(){var n=[];this.$refs.upload.uploadFiles.forEach(function(e){n.push(e.name)}),p()(new u.a(n)).length===n.length?this.$refs.upload.submit():this.$message({duration:2e3,message:"请删除上传列表中重复的书籍后再上传！",type:"warning"})},handleSuccessFn:function(){this.$message({duration:1500,message:"上传书籍成功！",type:"success"})},handleErrorFn:function(n){console.log(n)},handleSelectionChange:function(n){this.multipleSelect=n},changeNovelStateFn:function(){var n=r()(i.a.mark(function n(e,t,a){var s,o,l,r,c,u=this;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s=this.list.findIndex(function(n){return n.id==e.id}),o={id:e.id,name:e.name,cat_id:e.cat_id,desc:e.desc,user_id:e.user_id,tag:e.tag.toString(),sort:e.sort,status:e.status,serial_status:e.serial_status,img:e.img,wf_img:e.wf_img,free_chapter_num:e.free_chapter_num},l=!1,1==t?(o.status=a,l=!0):2!=t&&3!=t||(r=new RegExp("^[0-9]*[1-9][0-9]*$"),2==t&&r.test(Number(e.sort))?l=!0:3==t&&r.test(Number(e.free_chapter_num))?l=!0:this.$message({duration:1500,message:"请输入不小于0的正整数",type:"warning"})),l){n.next=7;break}return 1==t?this.bookList.data[s].status=this.list[s].status:2==t?this.bookList.data[s].sort=this.list[s].sort:3==t&&(this.bookList.data[s].free_chapter_num=this.list[s].free_chapter_num),n.abrupt("return");case 7:return n.next=9,this.$store.dispatch("postBookUpdate",o);case 9:200==n.sent.code?"3"==a||"1"==a?(c={content:"",user_id:e.user_id,uid:Object(b.c)(),book_id:e.id,status:a},"3"==a?this.$prompt("请输入未审核通过原因","提示",{confirmButtonText:"提交",showCancelButton:!1,closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1}).then(function(n){var e=n.value;c.content=e,u.getSendMsgFn(c)}).catch(function(){}):this.getSendMsgFn(c)):this.$message({duration:1500,message:"修改成功",type:"success"}):1==t?this.bookList.data[s].status=this.list[s].status:2==t?this.bookList.data[s].sort=this.list[s].sort:3==t&&(this.bookList.data[s].status=this.list[s].status);case 11:case"end":return n.stop()}},n,this)}));return function(e,t,a){return n.apply(this,arguments)}}(),getSendMsgFn:function(n){this.$store.dispatch("getSendMsg",n),this.$message({duration:1500,message:"修改成功",type:"success"})},handleCurrentChange:function(n){this.params.page=n,this.getBookListFn()},handleSortChangeFn:function(n){this.params.orderby=n.prop,this.params.orderway="ascending"==n.order?"asc":"desc",this.params.page=1,this.getBookListFn()},getBookListFn:function(){var n=r()(i.a.mark(function n(){var e;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.loading=!0,n.next=3,this.$store.dispatch("getBookList",this.params);case 3:200==(e=n.sent).code&&(e.data=JSON.parse(s()(e.data)),this.list=e.data.data),this.loading=!1;case 6:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),multipleDeleteFn:function(){var n=r()(i.a.mark(function n(e){var t;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(1!=e){n.next=8;break}if(t=[],this.multipleSelect.forEach(function(n){t.push(n.id)}),!(t.length>0)){n.next=8;break}return n.next=6,this.$store.dispatch("deleteBookDel",{book_id:t});case 6:200==n.sent.code?(this.$message({duration:1500,message:"删除成功！",type:"success"}),this.getBookListFn()):this.$refs.multipleTable.clearSelection();case 8:this.multipleDelete=!1;case 9:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}()},created:function(){this.hidenTXT=!0,this.params.role_type=Object(b.d)().role_type,this.params.admin_id=Object(b.d)().admin_id,this.getBookListFn()},mounted:function(){}},_={render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"app-container dropdown-container"},[t("div",{staticClass:"bar flex"},[t("div",{staticClass:"flex-left"},[t("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[n._v("书籍分类")]),n._v(" "),t("el-cascader",{attrs:{placeholder:"选择书籍分类",options:n.categorySelect,filterable:"","show-all-levels":!1},on:{change:n.changeBookCategoryFn},model:{value:n.selectedCategoryOptions,callback:function(e){n.selectedCategoryOptions=e},expression:"selectedCategoryOptions"}}),n._v(" "),t("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[n._v("书籍状态")]),n._v(" "),t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择书籍状态"},on:{change:n.changeBookStatusFn},model:{value:n.searchKey.state,callback:function(e){n.$set(n.searchKey,"state",e)},expression:"searchKey['state']"}},n._l(n.states,function(n){return t("el-option",{key:n.value,attrs:{label:n.label,value:n.value}})})),n._v(" "),t("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[n._v("书籍来源")]),n._v(" "),t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择书籍来源"},on:{change:n.changeBookSourceFn},model:{value:n.searchKey.source,callback:function(e){n.$set(n.searchKey,"source",e)},expression:"searchKey['source']"}},n._l(n.sources,function(n,e){return t("el-option",{key:e,attrs:{label:n.name,value:n.id}})}))],1),n._v(" "),t("div",{staticClass:"flex-right"},[t("label",{staticClass:"radio-label"},[t("el-radio",{attrs:{label:"1"},model:{value:n.radio,callback:function(e){n.radio=e},expression:"radio"}},[n._v("小说ID")]),n._v(" "),t("el-radio",{attrs:{label:"2"},model:{value:n.radio,callback:function(e){n.radio=e},expression:"radio"}},[n._v("小说名称")])],1),n._v(" "),t("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:n.placeholder,size:"mini","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(e){if(!("button"in e)&&n._k(e.keyCode,"enter",13,e.key))return null;n.fuzzyQueryFn(e)}},model:{value:n.keywords,callback:function(e){n.keywords=e},expression:"keywords"}}),n._v(" "),t("el-button",{staticClass:"search",attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:n.fuzzyQueryFn}},[n._v("搜索")]),n._v(" "),n.hidenTXT?n._e():t("el-button",{attrs:{type:"primary",icon:"el-icon-upload",size:"mini"},on:{click:function(e){n.bookUploadVisible=!0}}},[n._v("上传TXT\n        ")]),n._v(" "),t("router-link",{attrs:{to:"/novelManage/novel/add"}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"}},[n._v("新增")])],1)],1)]),n._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:n.bookList.data,border:"",stripe:"",multipleTable:""},on:{"selection-change":n.handleSelectionChange,"sort-change":n.handleSortChangeFn}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),n._v(" "),t("el-table-column",{attrs:{prop:"id",label:"ID","min-width":"80",fixed:"",sortable:"custom"}}),n._v(" "),t("el-table-column",{attrs:{prop:"name",label:"小说名称","min-width":"120","show-overflow-tooltip":""}}),n._v(" "),t("el-table-column",{attrs:{prop:"_pen_name",label:"作者笔名","min-width":"80","show-overflow-tooltip":""}}),n._v(" "),t("el-table-column",{attrs:{prop:"_cat_name",label:"所属分类","min-width":"80"}}),n._v(" "),t("el-table-column",{attrs:{prop:"word_count",label:"小说字数","min-width":"120"}}),n._v(" "),t("el-table-column",{attrs:{prop:"_cqms_user_id",label:"书籍来源","min-width":"120"}}),n._v(" "),t("el-table-column",{attrs:{prop:"status",label:"小说状态","min-width":"120"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-select",{attrs:{placeholder:"请选择小说状态"},on:{change:function(t){n.changeNovelStateFn(e.row,1,t)}},model:{value:e.row.status,callback:function(t){n.$set(e.row,"status",t)},expression:"scope.row.status"}},n._l(n.changeStates,function(n,e){return t("el-option",{key:e,attrs:{label:n.label,value:n.value}})}))]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"sort",label:"排序","min-width":"80",sortable:"custom"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-input",{attrs:{placeholder:"输入序号",type:"tel"},on:{change:function(t){n.changeNovelStateFn(e.row,2)}},model:{value:e.row.sort,callback:function(t){n.$set(e.row,"sort",t)},expression:"scope.row.sort"}})]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"free_chapter_num",label:"收费章节序号","min-width":"80"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-input",{attrs:{placeholder:"收费章节序号",type:"tel"},on:{change:function(t){n.changeNovelStateFn(e.row,3)}},model:{value:e.row.free_chapter_num,callback:function(t){n.$set(e.row,"free_chapter_num",t)},expression:"scope.row.free_chapter_num"}})]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"created_at",label:"创建时间","min-width":"120","show-overflow-tooltip":""}}),n._v(" "),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"110"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-dropdown",{attrs:{"split-button":"",type:"primary"},on:{command:function(t){n.handleCommand(e.row,t)},click:function(t){n.handleCommand(e.row,"edit")}}},[t("span",[n._v("编辑")]),n._v(" "),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[n._v("删除")]),n._v(" "),t("el-dropdown-item",{attrs:{command:"export"}},[n._v("导出")])],1)],1)]}}])})],1),n._v(" "),t("div",{staticClass:"pagination-container clearfix"},[t("div",{staticClass:"float-left mr-30"},[t("el-popover",{attrs:{placement:"top",width:"100"},model:{value:n.multipleDelete,callback:function(e){n.multipleDelete=e},expression:"multipleDelete"}},[t("p",[n._v("确认删除选择的书籍？")]),n._v(" "),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){n.multipleDeleteFn(0)}}},[n._v("取消")]),n._v(" "),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){n.multipleDeleteFn(1)}}},[n._v("确定")])],1),n._v(" "),t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger",disabled:n.multipleDeleteVisible},on:{click:function(e){n.multipleDelete=!0}},slot:"reference"},[n._v("删除")])],1)],1),n._v(" "),t("div",{staticClass:"float-left"},[t("global-pagination",{attrs:{"current-page":n.params.page,"page-size":n.params.per_page,layout:"total, sizes, prev, pager, next, jumper",total:n.bookList.total},on:{"current-change":n.handleCurrentChange,"size-change":n.handleSizeChange}})],1)]),n._v(" "),t("el-dialog",{attrs:{title:"上传书籍",visible:n.bookUploadVisible,width:"450px"},on:{"update:visible":function(e){n.bookUploadVisible=e}}},[t("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{center:"",drag:"",name:"book",accept:"text/plain",action:"/admin/upload_book","on-success":n.handleSuccessFn,"on-error":n.handleErrorFn,"auto-upload":!1}},[t("i",{staticClass:"el-icon-upload"}),n._v(" "),t("div",{staticClass:"el-upload__text"},[n._v("将文件拖到此处，或\n          "),t("em",[n._v("点击选择")])]),n._v(" "),t("div",{staticClass:"el-upload__tip clearfix",attrs:{slot:"tip"},slot:"tip"},[n._v("只能上传TXT文件 "),t("el-button",{staticClass:"float-right",attrs:{size:"small",type:"success"},on:{click:n.submitUpload}},[n._v("上传到服务器")])],1)])],1)],1)},staticRenderFns:[]};var v=t("VU/8")(g,_,!1,function(n){t("1QNQ")},null,null);e.default=v.exports}});