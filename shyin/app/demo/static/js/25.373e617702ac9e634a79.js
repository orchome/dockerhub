webpackJsonp([25],{SvB5:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("Xxa5"),i=e.n(a),r=e("Gu7T"),l=e.n(r),o=e("exGp"),n=e.n(o),c=e("Dd8w"),p=e.n(c),h=e("GQaK"),u=e("qERK"),d=e("SJI6"),g=e("Izdj"),f={components:{loading:u.a},mixins:[g.a],computed:p()({},Object(d.mapGetters)({chapterInfo:"chapterInfo",desc:"desc",ppids:"ppids"}),{ppid:function(){var t=this,s=this.ppids.findIndex(function(s){return s.book_id==t.$route.params.id});return s>-1?this.ppids[s].ppid:""},isReallyBuy:function(){var t=this.chapterInfo;return!(2!=t.charge_type||!t.is_buy)}}),watch:{scrollY:function(t){var s=((Number(t.replace("%",""))+100)/100).toFixed(2);if("0%"==t)this.scroll&&this.scroll.scrollTo(0,-this.scrollHeight,200,"bounce");else{var e=~~(s*this.scrollHeight);this.scrollToY=e,this.scroll&&this.scroll.scrollTo(0,-e,200,"bounce"),s>.85&&!this.loading&&this.params.page<=this.lastpage&&this.getBookAdNewFn()}},scrollHeight:function(t){var s=~~(this.scrollToY/t*100)-100;this.$refs.track.style.transform="translateY("+s+"%)"},isLoad:function(t){var s=document.querySelector("#directory > div.chapters-wrapper > ul > li.chapter.record");if(t&&this.$route.query&&this.$route.query.location&&s){var e=s.offsetTop+s.clientHeight,a=this.$refs.wrapper.clientHeight,i=this.$refs.wrapperUl.clientHeight;e>a&&this.scroll&&this.scroll.scrollTo(0,a-i+50,200,"bounce")}}},data:function(){return{scroll:"",pullingUpStart:!1,isHaveData:!0,scrollHeight:0,scrollY:0,scrollbar:0,scrollToY:0,endY:0,loading:!1,book_id:this.$route.params.id,is_automatic:0,params:{page:1},list:[],lastpage:2,pullDirection:"up",pullUpPage:1,pullDownPage:1,isLoad:!1}},methods:{changeDescFn:function(t){this.params.page=1,this.$store.dispatch("setBookAdDesc",t),this.pullUpPage=1,this.pullDownPage=1,this.getBookAdNewFn(1)},toReadFn:function(t){2==this.chapterInfo.follow_type&&0==this.chapterInfo.is_focus&&Number(t.sort)>=Number(this.chapterInfo.concern_chapter)?this.$store.dispatch("setConcernVisible",{show:!0,hidden:!1}):(this.params.page=1,localStorage.setItem("is_automatic",this.is_automatic),this.$router.push("/read/"+this.book_id+"/"+t.id))},touchmoveFn:function(t){var s=~~(t.targetTouches[0].pageY/this.scrollbar*100);s>=100?(this.$refs.track.style.transform="translateY(0%)",this.scrollY="0%"):s<=0?(this.$refs.track.style.transform="translateY(-100%)",this.scrollY="-100%"):(this.$refs.track.style.transform="translateY("+(s-100)+"%)",this.scrollY=s-100+"%")},initBScroll:function(){var t=this;""==this.scroll||this.scroll?this.$nextTick(function(){t.scroll=new h.a(t.$refs.wrapper,{click:!0,probeType:2,pullUpLoad:{threshold:50,stop:0},pullDownRefresh:{threshold:50,stop:0},bounce:{top:!0,bottom:!0,left:!1,right:!1}}),t.scroll.on("pullingUp",function(){t.pullDirection="up",t.isHaveData&&(t.pullingUpStart=!0,t.pullUpPage<t.lastpage&&(t.pullUpPage=t.pullUpPage+1,t.params.page=t.pullUpPage,t.getBookAdNewFn()))}),t.scroll.on("pullingDown",function(){t.pullDirection="down",t.pullDownPage>1&&(t.pullDownPage=t.pullDownPage-1,t.params.page=t.pullDownPage,t.getBookAdNewFn())}),t.scroll.on("scroll",function(s){var e=100*(~~Math.abs(s.y)/t.scrollHeight-1);t.$refs.track.style.transform=e<=0?"translateY("+e+"%)":"translateY(0%)"})}):this.scroll.refresh()},calcScrollHeightFn:function(){this.scrollbar=this.$refs.scrollbar.clientHeight,this.scrollHeight=~~(this.$refs.wrapperUl.clientHeight-this.$refs.wrapper.clientHeight)},goBackFn:function(){this.$router.go(-1)},getBookAdNewFn:function(){var t=n()(i.a.mark(function t(){var s,e,a=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!1,t.next=3,this.$store.dispatch("getBookAd",{page:this.params.page,book_id:this.book_id,desc:this.desc,ppid:this.ppid});case 3:s=t.sent,this.pullingUpStart=!1,200==s.code&&(this.lastpage=s.data.last_page,this.is_automatic=s.is_automatic,e=[].concat(l()(s.data.data)),1==s.data.current_page&&1==this.pullUpPage&&1==this.pullDownPage?this.list=e:s.data.current_page>=1&&("down"==this.pullDirection?(this.pullDownPage=s.data.current_page,this.list=e.concat(this.list)):(this.pullUpPage=s.data.current_page,this.list=this.list.concat(e))),this.$nextTick(function(){a.calcScrollHeightFn(),"up"==a.pullDirection&&a.scroll?a.pullUpPage>=s.data.last_page?(a.isHaveData=!1,a.scroll.closePullUp()):(a.isHaveData=!0,a.scroll.finishPullUp()):"down"==a.pullDirection&&a.scroll&&a.scroll.finishPullDown(),a.scroll&&(a.scroll.refresh(),1==r&&a.scroll.scrollTo(0,0,200,"bounce")),a.isLoad=!0})),this.loading=!1;case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},created:function(){this.$route.query&&this.$route.query.location&&(this.params.page=Number(this.$route.query.location),this.pullDownPage=Number(this.$route.query.location),this.pullUpPage=Number(this.$route.query.location)),this.getBookAdNewFn(),this.getQrcodeNewFn()},mounted:function(){var t=this;setTimeout(function(){t.initBScroll()},20)},destroyed:function(){this.$refs.scroll&&this.$refs.scroll.destroy()}},v={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{attrs:{id:"directory"}},[e("div",{staticClass:"header"},[e("span",{staticClass:"back",on:{click:t.goBackFn}}),t._v(" "),e("h4",[t._v("目录")]),t._v(" "),e("div",{staticClass:"sort"},[e("span",{staticClass:"asc",on:{click:function(s){t.changeDescFn("0")}}}),t._v(" "),e("span",{staticClass:"desc",on:{click:function(s){t.changeDescFn("1")}}})])]),t._v(" "),e("div",{ref:"wrapper",staticClass:"chapters-wrapper"},[e("ul",{ref:"wrapperUl"},[t._l(t.list,function(s){return e("li",{key:s.id,staticClass:"chapter",class:{vip:0!=s.is_vip,record:s.id==t.chapterInfo.read_record,subscribe:0!=s.is_subscribe},on:{click:function(e){t.toReadFn(s)}}},[t._v("\n        "+t._s(s.name)+"\n        "),s.sort>t.chapterInfo.free_chapter&&t.isReallyBuy?e("span",[t._v("已购买")]):s.sort>=t.chapterInfo.free_chapter&&1==s.is_subscribe&&s.id!=t.chapterInfo.read_record?e("span",{staticClass:"text"},[t._v("已购买")]):e("span",{staticClass:"icon"})])}),t._v(" "),e("li",{staticClass:"bottom-top"},[t.pullingUpStart?e("loading"):t._e(),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.pullingUpStart&&t.isHaveData,expression:"!pullingUpStart&&isHaveData"}],staticClass:"loading-hook"},[t._v("加载更多")]),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.pullingUpStart&&!t.isHaveData,expression:"!pullingUpStart&&!isHaveData"}],staticClass:"loading-hook"},[t._v("没有更多章节了")])],1)],2)]),t._v(" "),e("div",{ref:"scrollbar",staticClass:"scrollbar"}),t._v(" "),e("div",{ref:"track",staticClass:"track-wrapper"},[e("div",{staticClass:"track",on:{touchmove:function(s){return s.stopPropagation(),s.preventDefault(),t.touchmoveFn(s)}}},[e("span",{staticClass:"scrollbar-block"})])])])},staticRenderFns:[]};var _=e("VU/8")(f,v,!1,function(t){e("ekUz")},null,null);s.default=_.exports},ekUz:function(t,s){}});