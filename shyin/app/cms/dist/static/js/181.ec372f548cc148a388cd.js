webpackJsonp([181],{"/VlN":function(t,e,a){var i=a("M4gO");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("7433d2bb",i,!0)},Fk1j:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Xxa5"),o=a.n(i),n=a("exGp"),r=a.n(n),l=a("Dd8w"),s=a.n(l),c=a("NYxO"),d=a("TAej"),p=a("8BG5"),u={components:{Upload:d.a,EmojiAppend:p.a},computed:s()({},Object(c.b)({categorySelect:"categorySelect",categoryArray:"categoryArray",cpsMaterialTitleList:"cpsMaterialTitleList"}),{categorySelectList:function(){var t=this._.cloneDeep(this.categorySelect);return t[0]&&t[0].label&&(t[0].label="全部分类"),t}}),watch:{dialogFormVisible:function(t){t||(this.form.title="",this.form.book_id="",this.form.active="1",this.form.id="")},isOpenDialog:function(){}},data:function(){return{uploadParams:{title:"上传活动Excel",action:"/admin/cps_import_active",template:"material_expand_title_activity"},visible:!1,isOpenDialog:!1,options:[],bookList:[],selectLoading:!1,dialogType:"add",loading:!1,dialogTitle:"新增文本标题",radio:"book_id",dialogFormVisible:!1,form:{id:"",active:"1",title:"",book_id:"",category:"2"},params:{page:1,category:"2",cat_id:"",active:"0",selectedCategoryOptions:[0],name:"",book_id:"",dataType:2,type:1},actives:[{id:"0",name:"全部"},{id:"1",name:"通用"},{id:"2",name:"活动"},{id:"3",name:"引导"},{id:"4",name:"美图"}],rules:{title:[{required:!0,message:"请输入文本标题",trigger:"blur"}],book_id:[{required:!0,message:"请选择书籍",trigger:"change"}]}}},created:function(){var t=r()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,this.getAjaxGetBookFn(),t.next=4,this.$store.dispatch("getCateList");case 4:this.getCPSMaterialListFn();case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),methods:{selectFaceFn:function(t){this.form.title+=t.alt},uploadFn:function(t){1==t?this.uploadParams={title:"上传活动Excel",action:"/admin/cps_import_active",template:"material_expand_title_activity.xls"}:2==t&&(this.uploadParams={title:"上传通用Excel",action:"/admin/cps_import_universal",template:"material_expand_title_universal.xls"}),this.visible=!0},deleteCPSMaterialDelFn:function(){var t=r()(o.a.mark(function t(e){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("deleteCPSMaterialDel",{id:e});case 2:200==t.sent.code&&(this.$message({message:"删除素材成功",type:"success",duration:1500}),this.getCPSMaterialListFn());case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),postCPSMaterialTextAddFn:function(){var t=r()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._.cloneDeep(this.form),t.next=3,this.$store.dispatch("postCPSMaterialTextAdd",e);case 3:200==t.sent.code&&(this.$message({message:"添加标题成功！",type:"success",duration:1500}),this.dialogFormVisible=!1,this.params.page=1,this.getCPSMaterialListFn());case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),postCPSMaterialUpdateFn:function(){var t=r()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._.cloneDeep(this.form),t.next=3,this.$store.dispatch("postCPSMaterialUpdate",e);case 3:200==t.sent.code&&(this.$message({message:"修改文本标题成功！",type:"success",duration:1500}),this.dialogFormVisible=!1,this.params.page=1,this.getCPSMaterialListFn());case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;"add"==e.dialogType?e.postCPSMaterialTextAddFn():"edit"==e.dialogType&&e.postCPSMaterialUpdateFn()})},resetForm:function(t){this.dialogFormVisible=!1,this.$refs[t].resetFields()},remoteMethod:function(t){var e=this;""!==t?(this.selectLoading=!0,setTimeout(function(){e.selectLoading=!1,e.options=e.bookList.filter(function(e){return e.id.indexOf(t)>-1||e.name.indexOf(t)>-1})},200)):this.options=[]},getAjaxGetBookFn:function(){var t=r()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("getCPSBook");case 2:200==(e=t.sent).code&&(e.data.forEach(function(t){return t.id=t.id+""}),this.bookList=e.data);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),changRadioFn:function(t){"name"==t.target.value?this.params.book_id="":this.params.name=""},addFn:function(){this.dialogTitle="新增文本标题",this.dialogType="add",this.dialogFormVisible=!0},editFn:function(t){this.isOpenDialog=!0,this.form.title=t.title,this.form.active=t.active,this.form.id=t.id,this.dialogTitle="编辑文本标题",this.dialogType="edit",this.dialogFormVisible=!0},handleCurrentChange:function(t){this.params.page=t,this.getCPSMaterialListFn()},fuzzyQueryFn:function(){this.params.page=1,this.getCPSMaterialListFn()},changeBookCategoryFn:function(t){this.params.page=1,this.params.cat_id=t[t.length-1],this.getCPSMaterialListFn()},getCPSMaterialListFn:function(){var t=r()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return delete(e=this._.cloneDeep(this.params)).selectedCategoryOptions,this.loading=!0,t.next=5,this.$store.dispatch("getCPSMaterialList",e);case 5:this.loading=!1;case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),changeSelectFn:function(){this.params.page=1,this.getCPSMaterialListFn()}}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container credit-dialog"},[a("div",{staticClass:"bar flex"},[a("div",{staticClass:"flex-left"},[a("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[t._v("类型")]),t._v(" "),a("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择类型"},on:{change:t.changeSelectFn},model:{value:t.params.active,callback:function(e){t.$set(t.params,"active",e)},expression:"params.active"}},t._l(t.actives,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),a("label",{staticClass:"radio-label"},[t._v("书籍分类")]),t._v(" "),a("el-cascader",{attrs:{placeholder:"选择书籍分类",options:t.categorySelectList,filterable:"","show-all-levels":!1},on:{change:t.changeBookCategoryFn},model:{value:t.params.selectedCategoryOptions,callback:function(e){t.$set(t.params,"selectedCategoryOptions",e)},expression:"params.selectedCategoryOptions"}})],1),t._v(" "),a("div",{staticClass:"flex-right"},[a("label",{staticClass:"radio-label",on:{change:t.changRadioFn}},[a("el-radio",{attrs:{label:"book_id"},model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}},[t._v("书籍ID")]),t._v(" "),a("el-radio",{attrs:{label:"name"},model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}},[t._v("书籍名称")])],1),t._v(" "),a("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:"输入搜索内容",size:"mini","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.fuzzyQueryFn(e)}},model:{value:t.params[t.radio],callback:function(e){t.$set(t.params,t.radio,e)},expression:"params[radio]"}}),t._v(" "),a("el-button",{staticClass:"search",attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:t.fuzzyQueryFn}},[t._v("搜索")]),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:t.addFn}},[t._v("新增")]),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",size:"mini"},on:{click:function(e){t.uploadFn(1)}}},[t._v("上传活动Excel")]),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",size:"mini"},on:{click:function(e){t.uploadFn(2)}}},[t._v("上传通用Excel")])],1)]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.cpsMaterialTitleList.data,border:"",stripe:""}},[a("el-table-column",{attrs:{prop:"id",label:"ID","min-width":"80",fixed:""}}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"文本标题","min-width":"150","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"book_id",label:"书籍ID","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"_book_name",label:"书籍名称","min-width":"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"_cat_name",label:"书籍分类","min-width":"120","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[2==e.row.active||3==e.row.active?a("span",[t._v("-")]):a("span",[t._v(t._s(e.row._cat_name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"_active",label:"类型","min-width":"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"created_at",label:"上传时间","min-width":"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.editFn(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-popover",{attrs:{placement:"top",width:"100"},model:{value:e.row.delete,callback:function(a){t.$set(e.row,"delete",a)},expression:"scope.row.delete"}},[a("p",[t._v("确认删除选择的素材？")]),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.row.delete=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){t.deleteCPSMaterialDelFn(e.row.id),e.row.delete=!1}}},[t._v("确定")])],1),t._v(" "),a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},on:{click:function(t){e.row.delete=!0}},slot:"reference"},[t._v("删除")])],1)]}}])})],1),t._v(" "),a("div",{staticClass:"pagination-container clearfix"},[a("div",{staticClass:"float-left"},[a("global-pagination",{attrs:{"current-page":t.params.page,"page-size":t.params.per_page,layout:"total, sizes, prev, pager, next, jumper",total:t.cpsMaterialTitleList.total},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1)]),t._v(" "),a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"ruleForm",attrs:{model:t.form,"label-width":"120px",rules:t.rules}},["add"==t.dialogType?a("el-form-item",{attrs:{label:"类型"}},[a("el-radio-group",{model:{value:t.form.active,callback:function(e){t.$set(t.form,"active",e)},expression:"form.active"}},[a("el-radio",{attrs:{label:"1"}},[t._v("通用")]),t._v(" "),a("el-radio",{attrs:{label:"2"}},[t._v("活动")]),t._v(" "),a("el-radio",{attrs:{label:"3"}},[t._v("引导")]),t._v(" "),a("el-radio",{attrs:{label:"4"}},[t._v("美图")])],1)],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"文本标题",prop:"title"}},[a("el-input",{attrs:{placeholder:"请输入文本标题"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}},[a("div",{attrs:{slot:"append"},slot:"append"},[a("emoji-append",{on:{select:t.selectFaceFn}})],1)])],1),t._v(" "),"add"==t.dialogType&&1==t.form.active?a("el-form-item",{attrs:{label:"书籍名称",prop:"book_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入书籍名称",filterable:"",remote:"","remote-method":t.remoteMethod,loading:t.selectLoading},model:{value:t.form.book_id,callback:function(e){t.$set(t.form,"book_id",e)},expression:"form.book_id"}},t._l(t.options,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(e.id))]),t._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.name))])])}))],1):t._e()],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.resetForm("ruleForm")}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1),t._v(" "),a("upload",{attrs:{visible:t.visible,template:t.uploadParams.template,title:t.uploadParams.title,action:t.uploadParams.action},on:{"update:visible":function(e){t.visible=e},success:t.getCPSMaterialListFn}},[t._v("仅允许上传xls结尾的文件")])],1)},staticRenderFns:[]};var f=a("VU/8")(u,m,!1,function(t){a("/VlN")},null,null);e.default=f.exports},M4gO:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.emoji-append {\n  cursor: pointer;\n  position: relative;\n  z-index: 100000;\n}\n.emoji-append .emoji-warpper {\n  position: absolute;\n  right: -20px;\n  top: 28px;\n}\n",""])}});