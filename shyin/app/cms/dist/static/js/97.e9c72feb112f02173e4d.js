webpackJsonp([97],{CKHE:function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=t("Xxa5"),s=t.n(a),l=t("exGp"),i=t.n(l),o=t("Dd8w"),r=t.n(o),c=t("NYxO"),p=t("0xDb"),u=t("E4LH"),d={name:"channelManaSettlementList",computed:r()({},Object(c.b)({cmCpsTotalList:"cmCpsTotalList",cqms_arr:"cmCqmsList",settleFreeList:"settleFreeList"})),watch:{settleType:function(){this.clearnParams(),this.getTableData()}},data:function(){return{loading:!1,ceshiValue:!1,settleType:2,params:{date:"",settlement_time_begin:"",settlement_time_end:"",status:"",cqms_user:"",page:1},selected_arr:[]}},created:function(){this.getTableData(),this.getCqmsArr()},methods:{getCqmsArr:function(){var n=this;return i()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.$store.dispatch("getCqmsList",{});case 2:case"end":return e.stop()}},e,n)}))()},getTableData:function(){1==this.settleType?this.getCmCpsTotalList():2==this.settleType&&this.getSettleMentFree()},getCmCpsTotalList:function(){var n=this,e=this._.cloneDeep(this.params);this.loading=!0,this.$store.dispatch("cmCpsTotalList",e).then(function(){n.loading=!1})},getSettleMentFree:function(){var n=this;this.loading=!0,this.params.free_status=this.params.status,this.$store.dispatch("getSettleMentFree",this.params).then(function(){n.loading=!1})},handleCurrentChange:function(n){this.params.page=n,this.getTableData()},tableSelectChange:function(n){this.selected_arr=n},getSearch:function(){this.params.page=1,this.getTableData()},getSumTotal:function(){var n=this;Object(p.d)("确定要批量结算吗？").then(function(){1==n.settleType?n.postCmGetSumTotal():2==n.settleType&&n.postSettlementFreeBatch()}).catch(function(){})},postCmGetSumTotal:function(){var n=this,e=[];this.selected_arr.forEach(function(n){e.push(n.id)});var t={orders:e};this.$store.dispatch("cmGetSumTotal",t).then(function(e){200==e.code&&(Object(p.i)("结算","success"),setTimeout(function(){n.getTableData()},1e3))})},postSettlementFreeBatch:function(){var n=this,e=[];this.selected_arr.forEach(function(n){e.push(n.id)});var t={ids:e=e.join(",")};this.$store.dispatch("postSettlementFreeBatch",t).then(function(e){200==e.code&&(Object(p.i)("结算","success"),setTimeout(function(){n.getTableData()},1e3))})},postSettleFreeShow:function(n){var e=this;this.$nextTick(function(){var t={id:n.id,is_show:n.free_show_status};e.$store.dispatch("postSettleFreeShow",t).then(function(n){200==n.code?Object(p.i)("修改成功","success"):e.getTableData()})})},postSettleFreeEdit:function(n){var e=this,t={id:n.id,free_divided:n.free_divided};this.$store.dispatch("postSettleFreeEdit",t).then(function(n){200==n.code?Object(p.i)("修改成功","success"):e.getTableData()})},getExcel:function(){var n=this._.cloneDeep(this.params);if(1==this.settleType){var e="/admin/settle_export?";for(var t in e+="page="+n.page,delete n.page,n)n[t]&&(e+="&"+t+"="+n[t]);window.open(e)}else if(2==this.settleType){var a="/admin/settlement/free/export?";for(var s in a+="page="+n.page,delete n.page,n)n[s]&&(a+="&"+s+"="+n[s]);window.open(a)}},goDetail:function(n){var e=n.cqms_user_id,t=n.date;this.$router.push({path:"/channelMana/settlementList/month/"+e+"/"+t})},changeChannelPro:function(n){var e=this;return i()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Object(u.c)(n.channel_pro)){t.next=4;break}return Object(p.i)("比例不正确","warning"),t.abrupt("return");case 4:return a={cqms_order_id:n.id,channel_pro:n.channel_pro},t.next=7,e.$store.dispatch("cmEditRadio",a);case 7:200==t.sent.code&&(Object(p.i)("修改成功","success"),setTimeout(function(){e.getTableData()},1e3));case 9:case"end":return t.stop()}},t,e)}))()},clearnParams:function(){this.params={date:"",settlement_time_begin:"",settlement_time_end:"",status:"",cqms_user:"",page:1}}}},m={render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"bar flex"},[t("div",{staticClass:"flex-left"},[t("el-radio-group",{model:{value:n.settleType,callback:function(e){n.settleType=e},expression:"settleType"}},[t("el-radio-button",{attrs:{label:1}},[n._v("付费模式")]),n._v(" "),t("el-radio-button",{attrs:{label:2}},[n._v("免费模式")])],1)],1)]),n._v(" "),t("div",{staticClass:"bar flex"},[t("div",{staticClass:"flex-left"},[t("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[n._v("收入月份:")]),n._v(" "),t("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"month","value-format":"yyyy-MM",placeholder:"请选择收入月份"},model:{value:n.params.date,callback:function(e){n.$set(n.params,"date",e)},expression:"params.date"}}),n._v(" "),t("label",{staticClass:"radio-label"},[n._v("结算起始时间：")]),n._v(" "),t("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd",placeholder:"请选择结算起始时间"},model:{value:n.params.settlement_time_begin,callback:function(e){n.$set(n.params,"settlement_time_begin",e)},expression:"params.settlement_time_begin"}}),n._v(" "),t("label",{staticClass:"radio-label"},[n._v("结算结束时间：")]),n._v(" "),t("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"datetime","value-format":"yyyy-MM-dd",placeholder:"请选择结算结束时间"},model:{value:n.params.settlement_time_end,callback:function(e){n.$set(n.params,"settlement_time_end",e)},expression:"params.settlement_time_end"}}),n._v(" "),t("label",{staticClass:"radio-label"},[n._v("结算状态")]),n._v(" "),t("el-select",{model:{value:n.params.status,callback:function(e){n.$set(n.params,"status",e)},expression:"params.status"}},[t("el-option",{attrs:{value:""}},[n._v("请选择")]),n._v(" "),t("el-option",{attrs:{value:"0",label:"未结算"}},[n._v("未结算")]),n._v(" "),t("el-option",{attrs:{value:"1",label:"已结算"}},[n._v("已结算")])],1),n._v(" "),t("label",{staticClass:"radio-label"},[n._v("内容商:")]),n._v(" "),t("el-select",{staticStyle:{width:"140px"},attrs:{placeholder:"请选择内容商"},model:{value:n.params.cqms_user,callback:function(e){n.$set(n.params,"cqms_user",e)},expression:"params.cqms_user"}},[t("el-option",{attrs:{value:"",label:"请选择"}},[n._v("请选择")]),n._v(" "),n._l(n.cqms_arr,function(n){return t("el-option",{key:n.value,attrs:{label:n.label,value:n.value}})})],2)],1),n._v(" "),t("div",{staticClass:"flex-right"},[t("el-button",{staticClass:"search",attrs:{type:"primary",size:"mini"},on:{click:n.getSearch}},[n._v("查询")]),n._v(" "),t("el-button",{staticClass:"search",attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:n.getExcel}},[n._v("导出")])],1)]),n._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"},{name:"show",rawName:"v-show",value:1==n.settleType,expression:"settleType == 1"}],staticStyle:{width:"100%","text-align":"center"},attrs:{data:n.cmCpsTotalList.data,border:"",stripe:""},on:{"selection-change":n.tableSelectChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{type:"index",label:"序号","min-width":"80",fixed:""}}),n._v(" "),t("el-table-column",{attrs:{prop:"user.name",label:"内容商","min-width":"150","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(e.row.user?e.row.user.name:"-"))])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"real_sale",label:"实际收入","min-width":"120",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{prop:"sale",label:"销售收入","min-width":"120","show-overflow-tooltip":"",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{prop:"channel_pro",label:"渠道费比例","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[t("el-input",{attrs:{type:"text"},on:{blur:function(t){n.changeChannelPro(e.row)}},model:{value:e.row.channel_pro,callback:function(t){n.$set(e.row,"channel_pro",t)},expression:"scope.row.channel_pro"}})],1)]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"channel_fee",label:"渠道费","min-width":"120","show-overflow-tooltip":"",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{prop:"proportion",label:"分成比例","min-width":"120","show-overflow-tooltip":"",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{prop:"divided",label:"收入分成","min-width":"120","show-overflow-tooltip":"",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{prop:"date",label:"收入月份","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(e.row.date.substring(0,7)))])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"status",label:"结算状态","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(0==e.row.status?"未结算":"已结算"))])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"settlement_time",label:"结算时间","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(0==e.row.status?"-":e.row.settlement_time))])]}}])}),n._v(" "),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){n.goDetail(e.row)}}},[n._v("查询当月详情")])]}}])})],1),n._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"},{name:"show",rawName:"v-show",value:2==n.settleType,expression:"settleType == 2"}],staticStyle:{width:"100%","text-align":"center"},attrs:{data:n.settleFreeList.data,border:"",stripe:""},on:{"selection-change":n.tableSelectChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),n._v(" "),t("el-table-column",{attrs:{type:"index",label:"序号","min-width":"80",fixed:""}}),n._v(" "),t("el-table-column",{attrs:{prop:"user.name",label:"内容商","min-width":"150","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(e.row.user?e.row.user.name:"-"))])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"free_divided",label:"广告分成收入","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[t("el-input",{attrs:{type:"text"},on:{blur:function(t){n.postSettleFreeEdit(e.row)}},model:{value:e.row.free_divided,callback:function(t){n.$set(e.row,"free_divided",t)},expression:"scope.row.free_divided"}})],1)]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"free_show_status",label:"是否显示","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(t){n.postSettleFreeShow(e.row)}},model:{value:e.row.free_show_status,callback:function(t){n.$set(e.row,"free_show_status",t)},expression:"scope.row.free_show_status"}})]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"date",label:"收入月份","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(e.row.date.substring(0,7)))])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"free_status",label:"结算状态","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(0==e.row.free_status?"未结算":"已结算"))])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"free_settlement_time",label:"结算时间","min-width":"120","show-overflow-tooltip":"",align:"center"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",[n._v(n._s(0==e.row.free_status?"-":e.row.free_settlement_time))])]}}])})],1),n._v(" "),t("div",{staticClass:"clearfix",staticStyle:{"margin-top":"20px"}},[t("el-button",{attrs:{type:"primary",disabled:0==n.selected_arr.length},on:{click:n.getSumTotal}},[n._v("批量结算")])],1),n._v(" "),t("div",{staticClass:"pagination-container clearfix"},[t("div",{staticClass:"float-left"},[t("global-pagination",{attrs:{"current-page":n.params.page,"page-size":n.params.per_page,layout:"total, sizes, prev, pager, next, jumper",total:1==n.settleType?n.cmCpsTotalList.total:n.settleFreeList.total},on:{"current-change":n.handleCurrentChange,"size-change":n.handleSizeChange}})],1)])],1)},staticRenderFns:[]};var h=t("VU/8")(d,m,!1,function(n){t("tv+m")},null,null);e.default=h.exports},fk5q:function(n,e,t){(n.exports=t("FZ+f")(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},"tv+m":function(n,e,t){var a=t("fk5q");"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);t("rjj0")("57ae2637",a,!0)}});