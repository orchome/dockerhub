webpackJsonp([148],{"4wFw":function(e,t,a){var o=a("6QBL");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a("rjj0")("4d18430b",o,!0)},"6QBL":function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.typeActive {\r\n\tcolor: #67c23a !important;\n}\n.unActive {\r\n\tcolor: #c0c4cc;\n}\n.unActive:hover {\r\n\tcolor: #606266;\n}\r\n",""])},znXB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("//Fk"),i=a.n(o),n=a("BO1k"),s=a.n(n),r=a("Gu7T"),l=a.n(r),c=a("c/Tr"),p=a.n(c),d=a("RRo+"),u=a.n(d),h=a("Xxa5"),m=a.n(h),f=a("exGp"),v=a.n(f),_=a("lHA8"),b=a.n(_),g=a("Dd8w"),y=a.n(g),k=a("NYxO"),w=a("TAej"),x=a("jwbk"),C={name:"CPSProductList",components:{Upload:w.a,NumberInput:x.a},computed:y()({},Object(k.b)({categorySelect:"categorySelect",cpsBookList:"cpsBookList",allBook:"allBook"}),{multipleDeleteVisible:function(){return 0===this.multipleSelect.length},categorySelectList:function(){var e=this._.cloneDeep(this.categorySelect);return e[0]&&e[0].label&&(e[0].label="全部分类"),e}}),watch:{dialogFormVisible:function(e){e||this.resetForm()}},data:function(){return{visible:!1,dialogFormVisible:!1,form:{book_id:[],charge_type:1,price:30},rules:{book_id:[{type:"array",required:!0,message:"请至少选择一本书籍",trigger:"change"}]},radio:"name",options:[{value:"is_exclusive",label:"独家"},{value:"is_newbook",label:"新书"},{value:"is_stick",label:"置顶"},{value:"is_hot",label:"劲爆"},{value:"is_original",label:"原创"}],loading:!1,params:{book_id:"",name:"",page:1,selectedCategoryOptions:[0],cat_id:"0",dispatch_ge:"",dispatch_le:"",sort:""},bookType:[],multipleSelect:[],multipleDelete:!1,bookTypeArray:new b.a(["is_hot","is_newbook","is_stick","is_exclusive","is_original"]),list:[],loadingSelect:!1,optionsBook:[]}},created:function(){var e=v()(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.$store.dispatch("getAjaxGetBook"),e.next=4,this.$store.dispatch("getCateList");case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),mounted:function(){this.getCPSBookListFn()},methods:{addFn:function(){this.form.charge_type=1,this.form.price=30,this.dialogFormVisible=!0},closedFn:function(){},postCPSBookCreateFn:function(){var e=v()(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("postCPSBookCreate",{book_id:this.form.book_id.toString(),charge_type:this.form.charge_type,price:this.form.price});case 2:200==e.sent.code&&(this.$message({duration:1500,message:"添加成功",type:"success"}),this.getCPSBookListFn(),this.dialogFormVisible=!1);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),remoteMethod:function(e){var t=this;""!==e?(this.loadingSelect=!0,setTimeout(function(){t.loadingSelect=!1,t.optionsBook=t.allBook.filter(function(t){return t.id.indexOf(e)>-1||t.name.indexOf(e)>-1})},200)):this.optionsBook=[]},submitForm:function(){var e=this;""!=this.form.price?this.$refs.form.validate(function(t){if(!t)return console.log("error submit!!"),!1;e.postCPSBookCreateFn()}):this.warningMsgFn("价格不正确，请重新输入！")},resetForm:function(){this.$refs.form.resetFields()},changeListFn:function(e,t){var a=this;if(!u()(Number(t[e]))||Number(t[e])<0){this.$message({duration:1500,message:"请输入不小于0的正整数",type:"warning"});var o=this.list.findIndex(function(e){return e.id==t.id});o>-1&&(this.cpsBookList.data[o][e]=this.list[o][e])}else{var i={};i.id=t.id,i[e]=t[e],this.postCPSBookUpdateFn(i).then(function(t){"0"==t.code&&t.index>-1&&(a.cpsBookList.data[t.index][e]=a.list[t.index][e])})}},changeBookTypeFn:function(e){var t=new b.a(e),a=p()(new b.a([].concat(l()(this.bookTypeArray)).filter(function(e){return!t.has(e)}))),o=!0,i=!1,n=void 0;try{for(var r,c=s()(e);!(o=(r=c.next()).done);o=!0){var d=r.value;this.params[d]=1}}catch(e){i=!0,n=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw n}}var u=!0,h=!1,m=void 0;try{for(var f,v=s()(a);!(u=(f=v.next()).done);u=!0){var _=f.value;delete this.params[_]}}catch(e){h=!0,m=e}finally{try{!u&&v.return&&v.return()}finally{if(h)throw m}}this.getCPSBookListFn()},changRadioFn:function(){"name"==this.radio?this.params.book_id="":this.params.name=""},changeBookCategoryFn:function(e){this.params.cat_id=Number(e[e.length-1]),this.params.page=1,this.getCPSBookListFn()},getCPSBookListFn:function(){var e=v()(m.a.mark(function e(){var t,a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,delete(t=this._.cloneDeep(this.params)).selectedCategoryOptions,"0"==t.cat_id&&(t.cat_id=""),e.next=6,this.$store.dispatch("getCPSBookList",t);case 6:200==(a=e.sent).code&&(this.list=this._.cloneDeep(a.data.data)),this.loading=!1;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleCommand:function(e,t){if(!e.no_chapter)if(1==t)this.$router.push({name:"CPSProductListEditer",params:{id:e.id}});else if(2==t)this.deleteBoxFn(e.id);else{var a={};a.id=e.id,"1"==e[t]?a[t]="0":a[t]="1",this.postCPSBookUpdateFn(a,t)}},handleSortChangeFn:function(e){"ascending"==e.order?this.params.sort="asc":this.params.sort="desc",this.fuzzyQueryFn()},multipleDeleteFn:function(e){if(0==e)this.multipleDelete=!1;else if(1==e){var t=[];this.multipleSelect.forEach(function(e){t.push(e.id)}),this.deleteCPSBookDel(t.toString())}},handleSelectionChange:function(e){this.multipleSelect=e},handleCurrentChange:function(e){this.params.page=e,this.getCPSBookListFn()},fuzzyQueryFn:function(){this.params.page=1,this.getCPSBookListFn()},deleteCPSBookDel:function(){var e=v()(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("deleteCPSBookDel",{id:t});case 2:200==e.sent.code&&(this.$message({duration:1500,message:"删除成功",type:"success"}),this.multipleDelete=!1,this.getCPSBookListFn());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),deleteBoxFn:function(e){var t=this;this.$confirm("此操作将永久删除该内容, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.deleteCPSBookDel(e)}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},blurDispatchFn:function(e,t){""!=t&&(!u()(Number(t))||Number(t)<=0)&&(this.$message({duration:1500,message:"请输入不小于0的正整数",type:"warning"}),this.params[e]="")},postCPSBookUpdateFn:function(){var e=v()(m.a.mark(function e(t,a){var o,n=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("postCPSBookUpdate",t);case 2:return o=e.sent,e.abrupt("return",new i.a(function(e){if(200==o.code){n.$message({duration:1500,message:"修改成功",type:"success"}),n.getCPSBookListFn();var i=n.cpsBookList.data.findIndex(function(e){return e.id==t.id});i>-1&&""!==a&&(n.cpsBookList.data[i][a]=t[a]),e({code:200})}else{var s=n.cpsBookList.data.findIndex(function(e){return e.id==t.id});s>-1&&""!==a&&(t[1==a]?n.cpsBookList.data[s][a]="0":n.cpsBookList.data[s][a]="1"),e({code:0,index:s})}}));case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container dropdown-container accounts-container"},[a("div",{staticClass:"bar flex"},[a("div",{staticClass:"flex-left"},[a("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[e._v("书籍分类")]),e._v(" "),a("el-cascader",{staticStyle:{width:"150px"},attrs:{placeholder:"选择书籍分类",options:e.categorySelectList,filterable:"","show-all-levels":!1},on:{change:e.changeBookCategoryFn},model:{value:e.params.selectedCategoryOptions,callback:function(t){e.$set(e.params,"selectedCategoryOptions",t)},expression:"params.selectedCategoryOptions"}}),e._v(" "),a("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[e._v("书籍属性")]),e._v(" "),a("el-select",{staticStyle:{width:"150px"},attrs:{multiple:"",placeholder:"请选择书籍属性，不选则默认全部"},on:{change:e.changeBookTypeFn},model:{value:e.bookType,callback:function(t){e.bookType=t},expression:"bookType"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[e._v("派单指数(不小于)")]),e._v(" "),a("el-input",{staticStyle:{width:"80px"},attrs:{placeholder:"默认为空",size:"mini"},on:{blur:function(t){e.blurDispatchFn("dispatch_ge",e.params.dispatch_ge)}},model:{value:e.params.dispatch_ge,callback:function(t){e.$set(e.params,"dispatch_ge",t)},expression:"params.dispatch_ge"}}),e._v(" "),a("label",{staticClass:"radio-label",staticStyle:{"padding-left":"0"}},[e._v("派单指数(不大于)")]),e._v(" "),a("el-input",{staticStyle:{width:"80px"},attrs:{placeholder:"默认为空",size:"mini"},on:{blur:function(t){e.blurDispatchFn("dispatch_le",e.params.dispatch_le)}},model:{value:e.params.dispatch_le,callback:function(t){e.$set(e.params,"dispatch_le",t)},expression:"params.dispatch_le"}})],1),e._v(" "),a("div",{staticClass:"flex-right"},[a("label",{staticClass:"radio-label",on:{change:e.changRadioFn}},[a("el-radio",{attrs:{label:"book_id"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("小说ID")]),e._v(" "),a("el-radio",{attrs:{label:"name"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("小说现书名")])],1),e._v(" "),a("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:"请输入搜索内容",size:"mini","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.fuzzyQueryFn(t)}},model:{value:e.params[e.radio],callback:function(t){e.$set(e.params,e.radio,t)},expression:"params[radio]"}}),e._v(" "),a("el-button",{staticClass:"search",attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.fuzzyQueryFn}},[e._v("搜索")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:e.addFn}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",size:"mini"},on:{click:function(t){e.visible=!0}}},[e._v("导入Excel")])],1)]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.cpsBookList.data,border:"",stripe:"",multipleTable:""},on:{"selection-change":e.handleSelectionChange,"sort-change":e.handleSortChangeFn}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"序号","min-width":"80",fixed:""}}),e._v(" "),a("el-table-column",{attrs:{prop:"book_id",label:"小说ID","min-width":"70","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"old_name",label:"小说原书名","min-width":"150","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"小说现书名","min-width":"150","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"author_name",label:"作者笔名","min-width":"120","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"_cat_id",label:"所属分类","min-width":"120","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"sex",label:"频道","min-width":"80","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"_is_ground",label:"小说状态","min-width":"80","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"recoment_read_chapter",label:"推荐阅读原文章节","min-width":"175"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.no_chapter?a("div",[a("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"请选择","data-s":t.row.recoment_read_chapter},on:{change:function(a){e.changeListFn("recoment_read_chapter",t.row)}},model:{value:t.row.recoment_read_chapter,callback:function(a){e.$set(t.row,"recoment_read_chapter",a)},expression:"scope2.row.recoment_read_chapter"}},e._l(t.row.chapters,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.sort,"data-s":e.sort}})}))],1):a("div",[e._v("该书无章节")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"concern_chapter",label:"关注章节","min-width":"175"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.no_chapter?a("div",[a("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"请选择"},on:{change:function(a){e.changeListFn("concern_chapter",t.row)}},model:{value:t.row.concern_chapter,callback:function(a){e.$set(t.row,"concern_chapter",a)},expression:"scope.row.concern_chapter"}},e._l(t.row.chapters,function(t,o){return a("el-option",{key:o,attrs:{label:t.name,value:t.sort}},[e._v(e._s(t.name))])}))],1):a("div",[e._v("该书无章节")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pay_chapter",label:"付费章节","min-width":"175"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.no_chapter?a("div",[a("el-select",{staticStyle:{width:"160px"},attrs:{placeholder:"请选择"},on:{change:function(a){e.changeListFn("pay_chapter",t.row)}},model:{value:t.row.pay_chapter,callback:function(a){e.$set(t.row,"pay_chapter",a)},expression:"scope3.row.pay_chapter"}},e._l(t.row.chapters,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.sort}})}))],1):a("div",[e._v("该书无章节")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"dispatch_index",label:"派单指数","min-width":"90",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini"},on:{change:function(a){e.changeListFn("dispatch_index",t.row)}},model:{value:t.row.dispatch_index,callback:function(a){e.$set(t.row,"dispatch_index",a)},expression:"scope.row.dispatch_index"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-dropdown",{attrs:{"split-button":"",type:"primary"},on:{command:function(a){e.handleCommand(t.row,a)},click:function(a){e.handleCommand(t.row,"1")}}},[a("span",[e._v("编辑")]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"2"}},[e._v("删除")]),e._v(" "),a("el-dropdown-item",{attrs:{command:"is_exclusive"}},[a("span",{staticClass:"unActive",class:{typeActive:1==t.row.is_exclusive}},[e._v("独家")])]),e._v(" "),a("el-dropdown-item",{attrs:{command:"is_newbook"}},[a("span",{staticClass:"unActive",class:{typeActive:1==t.row.is_newbook}},[e._v("新书")])]),e._v(" "),a("el-dropdown-item",{attrs:{command:"is_stick"}},[a("span",{staticClass:"unActive",class:{typeActive:1==t.row.is_stick}},[e._v("置顶")])]),e._v(" "),a("el-dropdown-item",{attrs:{command:"is_hot"}},[a("span",{staticClass:"unActive",class:{typeActive:1==t.row.is_hot}},[e._v("劲爆")])]),e._v(" "),a("el-dropdown-item",{attrs:{command:"is_original"}},[a("span",{staticClass:"unActive",class:{typeActive:1==t.row.is_original}},[e._v("原创")])])],1)],1)]}}])})],1),e._v(" "),a("div",{staticClass:"pagination-container clearfix"},[a("div",{staticClass:"float-left mr-30"},[a("el-popover",{attrs:{placement:"top",width:"100"},model:{value:e.multipleDelete,callback:function(t){e.multipleDelete=t},expression:"multipleDelete"}},[a("p",[e._v("确认删除选择的书籍？")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.multipleDeleteFn(0)}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.multipleDeleteFn(1)}}},[e._v("确定")])],1),e._v(" "),a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger",disabled:e.multipleDeleteVisible},on:{click:function(t){e.multipleDelete=!0}},slot:"reference"},[e._v("删除")])],1)],1),e._v(" "),a("div",{staticClass:"float-left"},[a("global-pagination",{attrs:{"current-page":e.params.page,"page-size":e.params.per_page,layout:"total, sizes, prev, pager, next, jumper",total:e.cpsBookList.total},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)]),e._v(" "),a("el-dialog",{attrs:{title:"新增小说",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px",rules:e.rules}},[a("el-form-item",{attrs:{label:"书籍名称",prop:"book_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入书籍名称/书籍ID",multiple:"",filterable:"",remote:"","remote-method":e.remoteMethod,loading:e.loadingSelect},model:{value:e.form.book_id,callback:function(t){e.$set(e.form,"book_id",t)},expression:"form.book_id"}},e._l(e.optionsBook,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.id))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.name))])])}))],1),e._v(" "),a("el-form-item",{attrs:{label:"收费方式"}},[a("el-radio-group",{model:{value:e.form.charge_type,callback:function(t){e.$set(e.form,"charge_type",t)},expression:"form.charge_type"}},[a("el-radio",{attrs:{label:1}},[e._v("按章收费")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("按本收费")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"价格"}},[a("div",{staticClass:"flex-box"},[e._v("\n\t\t\t\t\t\t"+e._s(1==e.form.charge_type?"每章":"每本")+"\n\t\t\t\t\t\t"),a("number-input",{attrs:{value:e.form.price,placeholder:"请输入价格"},on:{"update:value":function(t){e.$set(e.form,"price",t)}}}),e._v("书币\n\t\t\t\t\t")],1)])],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("提交")])],1)],1),e._v(" "),a("upload",{attrs:{visible:e.visible,"continue-download-text":"cps上传英文对照表"},on:{closed:e.closedFn,"update:visible":function(t){e.visible=t},success:e.getCPSBookListFn}},[e._v("仅允许上传xls结尾的文件")])],1)},staticRenderFns:[]};var F=a("VU/8")(C,S,!1,function(e){a("4wFw")},null,null);t.default=F.exports}});