webpackJsonp([30],{Lmr0:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.basic-wrapper[data-v-5f951416] {\r\n\tposition: relative;\r\n\tborder: 1px solid #000;\r\n\tmargin-bottom: 10px;\n}\n.basic-wrapper .point[data-v-5f951416] {\r\n\twidth: 90%;\n}\n.basic-wrapper .el-form-item[data-v-5f951416] {\r\n\tmargin-top: 10px;\n}\n.delete[data-v-5f951416] {\r\n\tposition: absolute;\r\n\ttop: 50%;\r\n\t-webkit-transform: translate(100%, -50%);\r\n\t        transform: translate(100%, -50%);\r\n\tright: -10px;\n}\r\n",""])},XAdy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),l=a.n(r),i=a("exGp"),o=a.n(i),n=a("RRo+"),s=a.n(n),u=a("Dd8w"),m=a.n(u),p=a("NYxO"),c=a("vU3h"),d=a("5Vl1"),v={name:"operationHomeTemplateAdd",components:{PonitTo:c.a,UploadImg:d.a},computed:m()({},Object(p.b)({}),{pointType:function(){return this.isBasicTemplate?[1,2,3,4,5,6,7]:[5,7]},isEdit:function(){return"edit"==this.$route.meta.type},isBasicTemplate:function(){return 1==this.ruleForm.type},hasPoint:function(){return 2==this.ruleForm.client||3==this.ruleForm.client||6==this.ruleForm.client||4==this.ruleForm.client||7==this.ruleForm.client},isFreeShow:function(){return!this.isBasicTemplate||!this.hasPoint},webPage:function(){var e=[];switch(this.ruleForm.client){case"1":e=[{value:"1",label:"首页"},{value:"2",label:"男频"},{value:"3",label:"女频"}];break;case"2":e=[{value:"4",label:"男频"},{value:"5",label:"女频"},{value:"6",label:"完本"},{value:"7",label:"免费"}];break;case"3":e=[{value:"8",label:"精选"},{value:"9",label:"男生"},{value:"10",label:"女生"}];break;case"4":e=[{value:"22",label:"男频"},{value:"23",label:"女频"}];break;case"6":e=[{value:"17",label:"男频"},{value:"18",label:"女频"},{value:"19",label:"完本"}];break;case"7":e=[{value:"20",label:"男频"},{value:"21",label:"女频"}];break;default:e=[]}return e}}),watch:{},data:function(){return{client_arr:[{label:"PC",value:"1"},{label:"APP",value:"2"},{label:"H5",value:"3"},{label:"小程序",value:"4"}],ruleForm:{adhibition:"1",name:"",time:[],is_free:"1",template:"1",type:"1",client:"",page:"",show_num:3,point:[{to_type:"5",to_value:"",to_img:"",resolution:""}],sort:""},rules:{adhibition:[{required:!0,message:"请选择应用",trigger:"change"}],name:[{required:!0,message:"请输入图片标题",trigger:"blur"}],client:[{required:!0,message:"请选择客户端",trigger:"change"}],page:[{required:!0,message:"请选择页面",trigger:"change"}],time:[{type:"array",required:!0,message:"请选择有效期",trigger:"change"}],sort:[{validator:function(e,t,a){t||t+""=="0"||a(new Error("序号不能为空")),setTimeout(function(){s()(Number(t))?a():a(new Error("请输入数字值"))},1e3)},trigger:"blur"}],show_num:[{validator:function(e,t,a){t||t+""=="0"||a(new Error("数量不能为空")),setTimeout(function(){s()(Number(t))?Number(t)<3?a(new Error("数量不能小于3")):a():a(new Error("请输入数字值"))},1e3)},trigger:"blur"}]}}},created:function(){this.isEdit&&this.getTemplateInfoFn(this.$route.params.id)},activated:function(){this.changeType()},methods:{getResolutionFn:function(e,t){this.ruleForm.point[e].resolution=t},deleteTemplateFn:function(e){this.ruleForm.point.splice(e,1)},changeTemplateTypeFn:function(e){this.ruleForm.show_num=1==e?"":3,this.ruleForm.point=[{to_type:"5",to_value:"",to_img:"",resolution:""}]},addTemplateFn:function(){this.ruleForm.point.push({to_type:"5",to_value:"",to_img:"",resolution:""})},changeClientFn:function(e){this.ruleForm={adhibition:this.ruleForm.adhibition,name:"",time:[],is_free:"1",template:"1",type:"1",client:e,show_num:3,page:"",point:[{to_type:"5",to_value:"",to_img:"",resolution:""}],sort:""}},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var a=t._.cloneDeep(t.ruleForm);if(a.start_time=a.time[0],a.end_time=a.time[1],a.level="1",delete a.time,t.hasPoint){for(var r=!0,l=a.point.length,i=0;i<l;i++){var o=a.point[i];if((1==o.to_type||4==o.to_type||5==o.to_type||6==o.to_type)&&""==o.to_value){t.$message({duration:1500,message:"请输入正确的指向目标",type:"warning"}),r=!1;break}if(2!=a.type&&""==o.to_img){t.$message({duration:1500,message:"请上传图片",type:"warning"}),r=!1;break}2!=o.to_type&&3!=o.to_type&&7!=o.to_type||delete o.to_value}r?t.isEdit?(a.id=t.$route.params.id,t.putTemplateUpdateFn(a)):t.putTemplateAddFn(a):console.log("error")}else delete a.point,delete a.template,delete a.type,t.isEdit?(a.id=t.$route.params.id,t.putTemplateUpdateFn(a)):t.putTemplateAddFn(a)})},resetForm:function(e){this.$refs[e].resetFields()},goBackFn:function(){this.resetForm("ruleForm"),this.$router.push("/operationManage/home")},putTemplateUpdateFn:function(){var e=o()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("putTemplateUpdate",t);case 2:200==e.sent.code&&(this.$message({duration:1500,message:"修改成功",type:"success"}),this.goBackFn());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),putTemplateAddFn:function(){var e=o()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("putTemplateAdd",t);case 2:200==e.sent.code&&(this.$message({duration:1500,message:"添加成功",type:"success"}),this.goBackFn());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getTemplateInfoFn:function(){var e=o()(l.a.mark(function e(t){var a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("getTemplateInfo",{id:t});case 2:200==(a=e.sent).code&&((r=a.data.point)&&r.length>0&&r.forEach(function(e){e.to_type+=""}),this.ruleForm={time:[a.data.start_time,a.data.end_time],client:a.data.client+"",adhibition:a.data.adhibition+"",page:a.data.page+"",sort:a.data.sort+"",name:a.data.name,point:r,is_free:a.data.is_free+"",template:a.data.template+"",type:a.data.type+"",show_num:a.data.show_num||3},this.client_arr=this.getClientArr());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),changeType:function(){var e=this;this.client_arr=this.getClientArr(),this.client_arr.forEach(function(t,a){"5"==t.value&&e.client_arr.splice(a,1)}),this.ruleForm.client="",this.ruleForm.page=""},getClientArr:function(){var e=this.ruleForm.adhibition,t=[];return 1==e?t=[{label:"PC",value:"1"},{label:"APP",value:"2"},{label:"H5",value:"3"},{label:"小程序",value:"4"}]:2==e&&(t=[{label:"客户端APP",value:"6"},{value:"7",label:"小程序"}]),t}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container clearfix"},[a("div",{staticClass:"float-left",staticStyle:{width:"650px"}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择应用",prop:"adhibition"}},[a("el-select",{attrs:{placeholder:"请选择类型"},on:{change:e.changeType},model:{value:e.ruleForm.adhibition,callback:function(t){e.$set(e.ruleForm,"adhibition",t)},expression:"ruleForm.adhibition"}},[a("el-option",{attrs:{label:"十音文学",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"免费小说",value:"2"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"选择客户端",prop:"client"}},[a("el-select",{attrs:{placeholder:"请选择客户端"},on:{change:e.changeClientFn},model:{value:e.ruleForm.client,callback:function(t){e.$set(e.ruleForm,"client",t)},expression:"ruleForm.client"}},e._l(e.client_arr,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"选择页面",prop:"page"}},[a("el-select",{attrs:{placeholder:"请选择页面"},model:{value:e.ruleForm.page,callback:function(t){e.$set(e.ruleForm,"page",t)},expression:"ruleForm.page"}},e._l(e.webPage,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"模板名称",prop:"name",rules:[{required:!0,message:"请输入模板名称",trigger:"blur"},{min:1,max:10,message:"长度在 1 到 10 个字符",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"请输入模板名称（10字以内）"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),e.hasPoint?a("el-form-item",{attrs:{label:"模板类型"}},[a("el-radio-group",{on:{change:e.changeTemplateTypeFn},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[a("el-radio",{attrs:{label:"1"}},[e._v("基础模板")]),e._v(" "),a("el-radio",{attrs:{label:"2"}},[e._v("功能模板")])],1)],1):e._e(),e._v(" "),e.hasPoint?a("el-form-item",{attrs:{label:"模板样式"}},[a("el-radio-group",{model:{value:e.ruleForm.template,callback:function(t){e.$set(e.ruleForm,"template",t)},expression:"ruleForm.template"}},[a("el-radio",{attrs:{label:"1"}},[e._v("模板1")]),e._v(" "),a("el-radio",{attrs:{label:"2"}},[e._v("模板2")]),e._v(" "),a("el-radio",{attrs:{label:"3"}},[e._v("模板3")]),e._v(" "),a("el-radio",{attrs:{label:"4"}},[e._v("模板4")]),e._v(" "),a("el-radio",{attrs:{label:"5"}},[e._v("模板5")])],1)],1):e._e(),e._v(" "),e.hasPoint&&!e.isBasicTemplate?a("el-form-item",{attrs:{label:"显示书籍数",prop:"show_num"}},[a("el-input",{attrs:{placeholder:"请输入模板显示书籍数量"},model:{value:e.ruleForm.show_num,callback:function(t){e.$set(e.ruleForm,"show_num",t)},expression:"ruleForm.show_num"}})],1):e._e(),e._v(" "),e.hasPoint?a("div",e._l(e.ruleForm.point,function(t,r){return a("div",{key:r,class:e.isBasicTemplate?"basic-wrapper":""},[a("div",{staticClass:"point"},[2!=e.ruleForm.type?a("el-form-item",{attrs:{label:"上传图片",required:""}},[a("upload-img",{attrs:{picture:t.to_img},on:{"update:picture":function(a){e.$set(t,"to_img",a)},getResolution:function(t){e.getResolutionFn(r,t)}}},[e._v("支持JPG、BMP、PNG、建议尺寸 750*299PX")])],1):e._e(),e._v(" "),a("ponit-to",{attrs:{"to-type":t.to_type,"to-value":t.to_value,type:e.pointType},on:{"update:toType":function(a){e.$set(t,"to_type",a)},"update:toValue":function(a){e.$set(t,"to_value",a)}}})],1),e._v(" "),r>0?a("div",{staticClass:"delete"},[a("el-button",{attrs:{type:"danger"},on:{click:function(t){e.deleteTemplateFn(r)}}},[e._v("删除")])],1):e._e()])})):e._e(),e._v(" "),e.isFreeShow?a("el-form-item",{attrs:{label:"是否免费"}},[a("el-radio-group",{model:{value:e.ruleForm.is_free,callback:function(t){e.$set(e.ruleForm,"is_free",t)},expression:"ruleForm.is_free"}},[a("el-radio",{attrs:{label:"1"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"2"}},[e._v("否")])],1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"排序",prop:"sort",required:""}},[a("el-input",{model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"有效期",prop:"time"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.ruleForm.time,callback:function(t){e.$set(e.ruleForm,"time",t)},expression:"ruleForm.time"}})],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:function(t){e.goBackFn()}}},[e._v("返回")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")]),e._v(" "),e.hasPoint&&e.isBasicTemplate?a("el-button",{attrs:{type:"warning"},on:{click:e.addTemplateFn}},[e._v("添加模板样式")]):e._e()],1)],1)],1),e._v(" "),e.hasPoint?a("div",{staticClass:"float-left",staticStyle:{"margin-left":"50px"}},[a("h3",{staticStyle:{"margin-top":"0"}},[e._v("模板预览")]),e._v(" "),a("div",{staticStyle:{width:"400px"}},[e.isBasicTemplate?a("img",{staticStyle:{width:"100%"},attrs:{src:"/static/template/b"+e.ruleForm.template+".png",alt:""}}):a("img",{staticStyle:{width:"100%"},attrs:{src:"/static/template/"+e.ruleForm.template+".png",alt:""}})])]):e._e()])},staticRenderFns:[]};var f=a("VU/8")(v,h,!1,function(e){a("zn1D")},"data-v-5f951416",null);t.default=f.exports},zn1D:function(e,t,a){var r=a("Lmr0");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("78ef3133",r,!0)}});