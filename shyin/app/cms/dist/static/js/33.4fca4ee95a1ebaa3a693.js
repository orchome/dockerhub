webpackJsonp([33],{IxpF:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,"\n.coverImage-uploader .el-upload {\r\n  border: 1px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\n}\n.coverImage-uploader .el-upload:hover {\r\n  border-color: #409eff;\n}\n.coverImage-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 150px;\r\n  height: 216px;\r\n  line-height: 216px;\r\n  text-align: center;\n}\n.coverImage {\r\n  width: 150px;\r\n  height: 216px;\r\n  display: block;\n}\r\n",""])},L08f:function(e,t,r){var o=r("IxpF");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);r("rjj0")("3ae820da",o,!0)},rwre:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("Xxa5"),a=r.n(o),s=r("exGp"),i=r.n(s),n=r("RRo+"),l=r.n(n),u=r("Dd8w"),c=r.n(u),m=r("NYxO"),d={computed:c()({isEdit:function(){return this.$route.fullPath.indexOf("/edit/")>-1},qiniuUpload:function(){return"http://up.qiniu.com"}},Object(m.b)({categoryList:"categoryList",bookTags:"bookTags",bookSources:"bookSources"})),watch:{},data:function(){return{real_view_count:0,sources:[{id:"0",name:"十音"}],qiniuHost:"",uploadData:{},uploadAcceptType:"image/jpeg,image/png",imageUrl:"",ruleForm:{name:"",desc:"",category:[],cat_id:"",user_id:"",status:"1",serial_status:"1",tags:[],tag:"",coverImage:"",img:"",wf_img:"",sort:0,noWatermarkCoverImage:"",word_count:"",view_count:""},tags:[],rules:{name:[{required:!0,message:"请输入18字以内的小说名称",trigger:"blur"},{min:1,max:18,message:"长度在 1 到 18 个字符",trigger:"blur"}],desc:[{required:!0,message:"请输入20字-300字的描述",trigger:"change"},{min:20,max:300,message:"长度在 20 到 300 个字符",trigger:"blur"}],category:[{type:"array",required:!0,message:"请选择所属分类",trigger:"change"}],user_id:[{validator:function(e,t,r){if(!t)return r(new Error("作者ID不能为空"));setTimeout(function(){l()(Number(t))?r():r(new Error("请输入数字值"))},1e3)},trigger:"blur",required:!0}],sort:[{validator:function(e,t,r){if(!t&&t+""!="0")return r(new Error("请输入序号"));setTimeout(function(){l()(Number(t))?r():r(new Error("请输入数字值"))},1e3)},trigger:"blur",required:!0}],out_id:[{validator:function(e,t,r){if(!t)return r(new Error("out_id不能为空"));setTimeout(function(){l()(Number(t))?r():r(new Error("请输入数字值"))},1e3)},trigger:"blur",required:!0}],view_count:[{validator:function(e,t,r){if(!t)return r(new Error("书籍人气不能为空"));setTimeout(function(){l()(Number(t))?r():r(new Error("请输入书籍人气"))},1e3)},trigger:"blur",required:!0}],coverImage:[{required:!0,message:"请上传封面",trigger:"blur"}]},submitLoding:!1}},methods:{getQiniuTokenFn:function(){var e=i()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("getQiniuToken");case 2:200==(t=e.sent).code&&(this.qiniuHost=t.host,this.uploadData={token:t.token});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleCoverImageSuccess:function(e){this.ruleForm.img=e.key,this.ruleForm.coverImage=this.qiniuHost+e.key},handleNoWatermarkCoverImageSuccess:function(e){this.ruleForm.wf_img=e.key,this.ruleForm.noWatermarkCoverImage=this.qiniuHost+e.key},beforeAvatarUpload:function(){var e=i()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.size/1024<=100){e.next=7;break}return this.$message.error("上传封面大小不能超过100KB!"),this.uploadData.token="",e.abrupt("return",!1);case 7:return e.next=9,this.$store.dispatch("getQiniuToken");case 9:if(200!=(r=e.sent).code){e.next=16;break}return this.qiniuHost=r.host,this.uploadData={token:r.token},e.abrupt("return",!0);case 16:return this.uploadData.token="",e.abrupt("return",!1);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.submitLoding=!0,t.isEdit?t.postBookUpdateFn():t.postBookCreateFn()})},postBookCreateFn:function(){var e=i()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ruleForm.category,this.ruleForm.cat_id=t.pop(),this.ruleForm.tag=this.ruleForm.tags.toString(),e.next=5,this.$store.dispatch("postBookCreate",this.ruleForm);case 5:200==e.sent.code&&(this.$message({duration:1500,message:"添加书籍成功！",type:"success"}),this.$router.push("/novelManage/novel")),this.submitLoding=!1;case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),resetForm:function(e){this.$router.push("/novelManage/volume"),this.$refs[e].resetFields()},getBookInfo:function(){var e=i()(a.a.mark(function e(t){var r,o,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("getBookInfo",{id:t});case 2:200==(r=e.sent).code&&(o=r.data,s=[],o.tag.length>0&&o.tag.forEach(function(e){s.push(e.id)}),this.real_view_count=o.real_view_count,this.ruleForm={id:o.id,name:o.name,desc:o.desc,category:[Number(o.category.parent_id),Number(o.category.id)],cat_id:o.category.id,user_id:o.user_id,status:o.status+"",serial_status:o.serial_status+"",tags:s,tag:"",coverImage:o.img?"http://res.shiyin.net/"+o.img:"",img:o.img,out_id:o.out_id,sort:o.sort,wf_img:o.FvqFzp2l7F7__gryElBd1VflkFIB,word_count:o.word_count,view_count:o.view_count,cqms_user_id:o.cqms_user_id,noWatermarkCoverImage:o.wf_img?"http://res.shiyin.net/"+o.wf_img:""},this.sources=this.bookSources.slice());case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),postBookUpdateFn:function(){var e=i()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this._.cloneDeep(this.ruleForm)).cat_id=t.category.pop(),t.tag=t.tags.toString(),delete t.noWatermarkCoverImage,delete t.coverImage,delete t.category,delete t.tags,e.next=9,this.$store.dispatch("postBookUpdate",t);case 9:200==e.sent.code&&(this.$message({duration:1500,message:"编辑书籍成功！",type:"success"}),this.$router.push("/novelManage/novel")),this.submitLoding=!1;case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},created:function(){var e=i()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("getCateList");case 2:return e.next=4,this.$store.dispatch("getTagSearch");case 4:this.$route.params&&this.$route.params.id&&this.getBookInfo(this.$route.params.id);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"500px"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"小说名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入小说名称"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"描述",prop:"desc"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入小说描述",rows:5,resize:"none"},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"所属分类",prop:"category"}},[r("el-cascader",{attrs:{placeholder:"选择书籍分类",options:e.categoryList,filterable:"","show-all-levels":!0},model:{value:e.ruleForm.category,callback:function(t){e.$set(e.ruleForm,"category",t)},expression:"ruleForm.category"}})],1),e._v(" "),e.isEdit?r("el-form-item",{attrs:{label:"书籍来源",prop:"category"}},[r("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择书籍来源"},model:{value:e.ruleForm.cqms_user_id,callback:function(t){e.$set(e.ruleForm,"cqms_user_id",t)},expression:"ruleForm.cqms_user_id"}},e._l(e.sources,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"作者ID",prop:"user_id"}},[r("el-input",{attrs:{placeholder:"请输入作者ID"},model:{value:e.ruleForm.user_id,callback:function(t){e.$set(e.ruleForm,"user_id",t)},expression:"ruleForm.user_id"}})],1),e._v(" "),e.isEdit?r("el-form-item",{attrs:{label:"字数"}},[r("span",[e._v(e._s(e.ruleForm.word_count))])]):e._e(),e._v(" "),e.isEdit?r("el-form-item",{attrs:{label:"书籍人气",prop:"view_count"}},[r("div",{staticClass:"mark-wrap"},[r("el-input",{model:{value:e.ruleForm.view_count,callback:function(t){e.$set(e.ruleForm,"view_count",t)},expression:"ruleForm.view_count"}}),e._v(" "),r("span",{staticClass:"mark"},[e._v("真实人气为"+e._s(e.real_view_count))])],1)]):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"标签",prop:"tags"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"","default-first-option":"",placeholder:"请选择书籍标签","multiple-limit":5},model:{value:e.ruleForm.tags,callback:function(t){e.$set(e.ruleForm,"tags",t)},expression:"ruleForm.tags"}},e._l(e.bookTags,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),r("el-form-item",{attrs:{label:"排序",prop:"sort"}},[r("el-input",{attrs:{placeholder:"请输入书籍排序"},model:{value:e.ruleForm.sort,callback:function(t){e.$set(e.ruleForm,"sort",t)},expression:"ruleForm.sort"}})],1),e._v(" "),e.isEdit?r("el-form-item",{attrs:{label:"out_id",prop:"out_id"}},[r("el-input",{model:{value:e.ruleForm.out_id,callback:function(t){e.$set(e.ruleForm,"out_id",t)},expression:"ruleForm.out_id"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"小说状态",prop:"status"}},[r("el-radio-group",{model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[r("el-radio",{attrs:{label:"1"}},[e._v("上架")]),e._v(" "),r("el-radio",{attrs:{label:"0"}},[e._v("下架")]),e._v(" "),r("el-radio",{attrs:{label:"2"}},[e._v("审核中")]),e._v(" "),e.isEdit?r("el-radio",{attrs:{label:"3"}},[e._v("审核未通过")]):e._e()],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"连载状态",prop:"serial_status"}},[r("el-radio-group",{model:{value:e.ruleForm.serial_status,callback:function(t){e.$set(e.ruleForm,"serial_status",t)},expression:"ruleForm.serial_status"}},[r("el-radio",{attrs:{label:"1"}},[e._v("连载中")]),e._v(" "),r("el-radio",{attrs:{label:"2"}},[e._v("暂停")]),e._v(" "),r("el-radio",{attrs:{label:"3"}},[e._v("完本")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"封面"}},[r("el-upload",{staticClass:"coverImage-uploader",attrs:{action:e.qiniuUpload,"show-file-list":!1,accept:e.uploadAcceptType,"on-success":e.handleCoverImageSuccess,data:e.uploadData,"before-upload":e.beforeAvatarUpload}},[e.ruleForm.coverImage?r("img",{staticClass:"coverImage",attrs:{src:e.ruleForm.coverImage}}):r("i",{staticClass:"el-icon-plus coverImage-uploader-icon"}),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("支持JPG、PNG、图片尺寸 150*216 像素、建议尺寸 300*432 像素")])])],1),e._v(" "),e.isEdit?r("el-form-item",{attrs:{label:"无水印LOGO封面",prop:"noWatermarkCoverImage"}},[r("el-upload",{staticClass:"coverImage-uploader",attrs:{action:e.qiniuUpload,"show-file-list":!1,accept:e.uploadAcceptType,"on-success":e.handleNoWatermarkCoverImageSuccess,data:e.uploadData,"before-upload":e.beforeAvatarUpload}},[e.ruleForm.noWatermarkCoverImage?r("img",{staticClass:"coverImage",attrs:{src:e.ruleForm.noWatermarkCoverImage}}):r("i",{staticClass:"el-icon-plus coverImage-uploader-icon"}),e._v(" "),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("支持JPG、PNG、图片尺寸 150*216 像素、建议尺寸 300*432 像素")])])],1):e._e(),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.submitLoding},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("提交")]),e._v(" "),r("el-button",{on:{click:function(t){e.resetForm("ruleForm")}}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var g=r("VU/8")(d,p,!1,function(e){r("L08f")},null,null);t.default=g.exports}});