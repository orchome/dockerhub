webpackJsonp([8],{"1Ld1":function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.widthFormInput {\n  width: 400px;\n}\n.pr {\n  position: relative;\n}\n.pa {\n  position: absolute;\n}\n.test-send {\n  right: -20px;\n  -webkit-transform: translate(100%, -100%);\n          transform: translate(100%, -100%);\n}\n.form-wrapper {\n  width: 1000px;\n}\n.form-wrapper .tip {\n  font-size: 12px;\n  color: #999;\n  margin-top: 5px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.el-card__body {\n  padding: 0;\n}\n.el-card__body .pic-text-box {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n}\n.el-card__body .pic-text-box .pic {\n      height: 180px;\n      width: 100%;\n      border-bottom: 1px solid #cccccc;\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      -webkit-box-align: center;\n          -ms-flex-align: center;\n              align-items: center;\n      -webkit-box-pack: center;\n          -ms-flex-pack: center;\n              justify-content: center;\n      cursor: pointer;\n}\n.el-card__body .pic-text-box .pic img {\n        width: 100%;\n        height: 100%;\n}\n.el-card__body .pic-text-box .pic .el-icon-plus {\n        font-size: 28px;\n        color: #8c939d;\n        width: 80px;\n        height: 80px;\n        line-height: 80px;\n        text-align: center;\n        border: 1px dotted #999;\n}\n.el-card__body .pic-text-box .link {\n      height: 50px;\n      line-height: 50px;\n      padding-left: 20px;\n      width: 100%;\n}\n.el-card__body .pic-text-box .link .el-icon-edit {\n        font-size: 20px;\n        cursor: pointer;\n}\n.el-card__body .pic-text-box .link.success span {\n        color: #606266;\n}\n.el-card__body .pic-text-box .link.success span.icon-wrapper {\n          border-color: #67c23a;\n}\n.el-card__body .pic-text-box .link.success i {\n        color: #67c23a;\n}\n.el-card__body .pic-text-box .link span {\n        cursor: pointer;\n        right: 10px;\n        color: red;\n}\n.el-card__body .pic-text-box .link span.icon-wrapper {\n          display: inline-block;\n          height: 18px;\n          width: 18px;\n          text-align: center;\n          line-height: 18px;\n          border-radius: 50%;\n          border: 1px solid red;\n}\n.el-card__body .pic-text-box .link_no_hand span {\n      cursor: auto;\n}\n.el-card__body .text-box {\n    padding: 10px 15px;\n}\n.el-card__body .text-box li {\n      display: -webkit-box;\n      display: -ms-flexbox;\n      display: flex;\n      border-bottom: 1px solid #eaeaea;\n      padding: 10px 0;\n}\n.el-card__body .text-box li .text {\n        -webkit-box-flex: 1;\n            -ms-flex: 1;\n                flex: 1;\n        -webkit-box-sizing: border-box;\n                box-sizing: border-box;\n        padding-right: 10px;\n}\n.el-card__body .add-text {\n    padding: 10px;\n    text-align: center;\n}\n.el-card__body .add-text .el-button {\n      width: 100px;\n}\n.app-container.info .el-input.is-disabled .el-input__inner {\n  color: #000;\n}\n",""])},"1NHD":function(t,e,i){"use strict";(function(t){var n=i("Xxa5"),r=i.n(n),o=i("exGp"),a=i.n(o),s=i("Dd8w"),l=i.n(s),c=i("NYxO"),d=i("dSdr");e.a={components:{addCpsTitle:d.a},name:"index",computed:l()({},Object(c.b)({cpsProductType:"cpsProductType"}),{titleVisible:function(){return"novel"==this.ruleForm.bind_type&&""==this.ruleForm.book_id}}),props:{type:{type:String,default:"img-text"},show:{type:Boolean,default:!1},add:{type:Boolean,default:!0},content:{default:function(){}},parentParams:{default:""},parentType:{type:String,default:"none"}},watch:{show:function(t){this.dialogShow=t},dialogShow:function(t){t?"text"==this.type?this.formatTextFn():this.formatImgTextFn():(this.$emit("update:show",!1),this.resetForm("ruleForm"))}},data:function(){return{active:1,rules:{book_id:[{required:!0,message:"请选择书籍目标",trigger:"change"}],activity_id:[{required:!0,message:"请选择活动目标",trigger:"change"}],album_id:[{required:!0,message:"请选择美图目标",trigger:"change"}],title_id:[{required:!0,message:"请选择标题",trigger:"change"}]},dialogShow:!1,ruleForm:{bind_type:"novel",book_id:"",title_id:"",activity_id:"",album_id:""},booksOptions:[],titleOptions:[],activityOptions:[],albumOptions:[],loading:!1}},mounted:function(){},methods:{formatImgTextFn:function(){for(var t in this.ruleForm={bind_type:"novel",book_id:"",title_id:"",activity_id:"",album_id:""},this.ruleForm)this.ruleForm[t]=this.content[t]||"";2==this.cpsProductType&&(this.ruleForm.bind_type="picture"),this.preGetDataFn(this.ruleForm.bind_type)},formatTextFn:function(){if(this.add)2==this.cpsProductType&&(this.ruleForm.bind_type="picture"),this.preGetDataFn();else{for(var t in this.content)this.ruleForm[t]=this.content[t];2==this.cpsProductType&&(this.ruleForm.bind_type="picture"),"novel"===this.content.bind_type?this.getMaterialBooksFn(this.content.book_id):"activity"===this.content.bind_type?(this.ruleForm.activity_id=Number(this.content.activity_id),this.getCPSSmartPushActivity(this.content.activity_id)):"picture"===this.content.bind_type&&this.getCPSSmartPushAlbum(this.content.album_id),this.content.title_name&&(this.titleOptions=[{id:this.content.title_id,name:this.content.title_name}])}},preGetDataFn:function(){switch(this.ruleForm.bind_type){case"novel":this.getMaterialBooksFn();break;case"activity":this.getCPSSmartPushActivity();break;case"picture":case"guide":this.getCPSSmartPushAlbum()}this.getMaterialTitlesFn()},changeSelectFn:function(){this.ruleForm.title_id="",this.titleOptions=[],this.preGetDataFn()},getTitleID:function(t){this.ruleForm.title_id=t.id,this.titleOptions=[{id:t.id+"",name:t.title}]},changeBindTypeFn:function(t){this.resetForm("ruleForm"),this.ruleForm={bind_type:t,book_id:"",title_id:"",activity_id:"",album_id:""},this.preGetDataFn()},addCPSTitleFn:function(){"novel"==this.ruleForm.bind_type?this.active=1:"activity"==this.ruleForm.bind_type?this.active=2:"guide"==this.ruleForm.bind_type?this.active=3:"picture"==this.ruleForm.bind_type&&(this.active=4),this.$refs.addcpstitle.open()},submitForm:function(t){var e=this;this.$refs[t].validate(function(i){if(!i)return console.log("error submit!!"),!1;var n=e._.cloneDeep(e.ruleForm),r={};if("novel"==n.bind_type){var o=e.booksOptions.find(function(t){return t.book_id==n.book_id}),a=e.titleOptions.find(function(t){return t.id==n.title_id});r={title_id:n.title_id,book_id:o.book_id,book_name:o.name,title_name:a.name,bind_type:"novel"}}else if("activity"==n.bind_type){var s=e.activityOptions.find(function(t){return t.id==n.activity_id}),l=e.titleOptions.find(function(t){return t.id==n.title_id});r={title_id:n.title_id,activity_id:n.activity_id,activity:s.title,title_name:l.name,bind_type:"activity"}}else if("picture"==n.bind_type){var c=e.albumOptions.find(function(t){return t.id==n.album_id}),d=e.titleOptions.find(function(t){return t.id==n.title_id});r={title_id:n.title_id,album_id:n.album_id,album:c.title,title_name:d.name,bind_type:"picture"}}else{var p=e.titleOptions.find(function(t){return t.id==n.title_id});r={title_id:n.title_id,title_name:p.name,bind_type:"guide"}}e.getContent(r),e.resetForm(t)})},resetForm:function(t){this.$refs[t].resetFields()},getContent:function(t){this.$emit("getContent",t),this.dialogShow=!1},getMaterialBooksFn:function(){var e=a()(r.a.mark(function e(){var i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,n=t.trim(n),e.next=4,this.$store.dispatch("getCPSSmartPushBooks",{name:n});case 4:i=e.sent,this.booksOptions=i.data,this.loading=!1;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getCPSSmartPushActivity:function(){var e=a()(r.a.mark(function e(){var i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,n=t.trim(n),e.next=4,this.$store.dispatch("getCPSSmartPushActivity",{name:n});case 4:i=e.sent,this.activityOptions=i.data,this.loading=!1;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getCPSSmartPushAlbum:function(){var e=a()(r.a.mark(function e(){var i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,n=t.trim(n),e.next=4,this.triggerActionsFn("getCPSSmartPushAlbum",{name:n});case 4:(i=e.sent)&&(this.albumOptions=i.data,this.loading=!1);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getMaterialTitlesFn:function(){var e=a()(r.a.mark(function e(){var i,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.trim(o),this.loading=!0,i={title:o},"novel"==this.ruleForm.bind_type?i.book_id=this.ruleForm.book_id:"activity"==this.ruleForm.bind_type?i.activity=2:"guide"==this.ruleForm.bind_type?i.activity=3:"picture"==this.ruleForm.bind_type&&(i.activity=4),e.next=6,this.$store.dispatch("getCPSSmartPushTitles",i);case 6:n=e.sent,this.titleOptions=n.data,this.loading=!1;case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},created:function(){var t=a()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}}).call(e,i("7t+N"))},Fsgs:function(t,e,i){var n=i("UgRR");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i("rjj0")("399697df",n,!0)},HI8J:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("Xxa5"),r=i.n(n),o=i("exGp"),a=i.n(o),s=i("mvHQ"),l=i.n(s),c=i("Dd8w"),d=i.n(c),p=i("NYxO"),u=i("msXN"),m={name:"index",computed:d()({},Object(p.b)({})),props:{show:{type:Boolean,default:!1},parentType:{type:String,default:"none"}},watch:{show:function(t){this.dialogShow=t},dialogShow:function(t){t||this.$emit("update:show",!1)}},data:function(){return{materialPic:{data:[],total:0},dialogShow:!1,params:{activity:"1",page:1,per_page:20}}},methods:{picPageChange:function(t){this.params.page=t,this.getMaterialPicFn()},handleSizeChange:function(t){this.params.per_page=t,this.getMaterialPicFn()},getBgImg:function(t){this.$emit("getBgImg",t),this.dialogShow=!1},changeParamsFn:function(){this.params.page=1,this.getMaterialPicFn()},getMaterialPicFn:function(){var t=a()(r.a.mark(function t(){var e,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._.cloneDeep(this.params),t.next=3,this.$store.dispatch("getCPSSmartPushPics",e);case 3:(i=t.sent).data.forEach(function(t){t._pic="http://res.shiyin.net/"+t.pic}),this.materialPic={data:i.data,total:i.meta.total};case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},mounted:function(){},created:function(){this.getMaterialPicFn()}},_={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"select-pic"},[i("el-dialog",{attrs:{title:"选择封面图片",visible:t.dialogShow,center:"",top:"5%","close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogShow=e}}},[i("el-form",{staticStyle:{width:"100%"}},[i("el-form-item",{attrs:{label:"类别"}},[i("el-radio-group",{on:{change:t.changeParamsFn},model:{value:t.params.activity,callback:function(e){t.$set(t.params,"activity",e)},expression:"params.activity"}},[i("el-radio",{attrs:{label:"1"}},[t._v("通用图片")]),t._v(" "),i("el-radio",{attrs:{label:"2"}},[t._v("活动图片")])],1)],1)],1),t._v(" "),i("ul",{staticClass:"img-box flex-box"},[i("p",{directives:[{name:"show",rawName:"v-show",value:0==t.materialPic.data.length,expression:"materialPic.data.length==0"}],staticStyle:{"font-size":"14px","text-align":"center"}},[t._v("暂时没有数据")]),t._v(" "),t._l(t.materialPic.data,function(e){return i("li",{key:e.id,on:{click:function(i){t.getBgImg(e)}}},[i("img",{attrs:{src:e._pic}})])})],2),t._v(" "),t.materialPic.data.length>0?i("div",{staticClass:"float-left"},[i("global-pagination",{attrs:{"current-page":t.params.page,"page-size":t.params.per_page,layout:"total, prev, pager, next",total:t.materialPic.total},on:{"current-change":t.picPageChange,"size-change":t.handleSizeChange}})],1):t._e()],1)],1)},staticRenderFns:[]};var f=i("VU/8")(m,_,!1,function(t){i("Fsgs")},null,null).exports,h=i("1NHD"),b={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"select-text"},[i("el-dialog",{attrs:{title:"选择标题",visible:t.dialogShow,center:"",top:"5%","close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogShow=e}}},[i("el-form",{ref:"ruleForm",attrs:{"label-width":"100px",rules:t.rules,model:t.ruleForm}},[i("el-form-item",{attrs:{label:"绑定类型"}},[i("el-radio-group",{on:{change:t.changeBindTypeFn},model:{value:t.ruleForm.bind_type,callback:function(e){t.$set(t.ruleForm,"bind_type",e)},expression:"ruleForm.bind_type"}},[1==t.cpsProductType||3==t.cpsProductType?i("el-radio",{attrs:{label:"novel"}},[t._v("书籍")]):t._e(),t._v(" "),1==t.cpsProductType||3==t.cpsProductType?i("el-radio",{attrs:{label:"activity"}},[t._v("活动")]):t._e(),t._v(" "),2==t.cpsProductType||3==t.cpsProductType?i("el-radio",{attrs:{label:"picture"}},[t._v("美图")]):t._e(),t._v(" "),"img-text"!==t.type?i("el-radio",{attrs:{label:"guide"}},[t._v("引导")]):t._e()],1)],1),t._v(" "),i("div",["novel"==t.ruleForm.bind_type?i("el-form-item",{attrs:{label:"书籍目标",prop:"book_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":t.getMaterialBooksFn,placeholder:"请选择小说名称",loading:t.loading},on:{change:t.changeSelectFn},model:{value:t.ruleForm.book_id,callback:function(e){t.$set(t.ruleForm,"book_id",e)},expression:"ruleForm.book_id"}},t._l(t.booksOptions,function(t){return i("el-option",{key:t.book_id,attrs:{label:t.name,value:t.book_id}})}))],1):t._e()],1),t._v(" "),i("div",["activity"==t.ruleForm.bind_type?i("el-form-item",{attrs:{label:"活动目标",prop:"activity_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":t.getCPSSmartPushActivity,placeholder:"请选择活动名称",loading:t.loading},on:{change:t.changeSelectFn},model:{value:t.ruleForm.activity_id,callback:function(e){t.$set(t.ruleForm,"activity_id",e)},expression:"ruleForm.activity_id"}},t._l(t.activityOptions,function(t){return i("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}))],1):t._e()],1),t._v(" "),i("div",["picture"==t.ruleForm.bind_type?i("el-form-item",{attrs:{label:"美图目标",prop:"album_id"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":t.getCPSSmartPushAlbum,placeholder:"请输入相册ID或相册标题搜索",loading:t.loading},on:{change:t.changeSelectFn},model:{value:t.ruleForm.album_id,callback:function(e){t.$set(t.ruleForm,"album_id",e)},expression:"ruleForm.album_id"}},t._l(t.albumOptions,function(t){return i("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}))],1):t._e()],1),t._v(" "),i("div",[i("el-form-item",{attrs:{label:"标题",prop:"title_id"}},[i("div",{staticClass:"bar flex"},[i("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":t.getMaterialTitlesFn,disabled:t.titleVisible,placeholder:"请选择标题",loading:t.loading},model:{value:t.ruleForm.title_id,callback:function(e){t.$set(t.ruleForm,"title_id",e)},expression:"ruleForm.title_id"}},t._l(t.titleOptions,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),t._v(" "),i("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",disabled:t.titleVisible},on:{click:t.addCPSTitleFn}},[t._v("新建")])],1)])],1),t._v(" "),i("el-form-item",[i("el-button",{on:{click:function(e){t.dialogShow=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1),t._v(" "),i("add-cps-title",{ref:"addcpstitle",attrs:{id:t.ruleForm.book_id,active:t.active,"append-to-body":""},on:{getTitleID:t.getTitleID}})],1)],1)},staticRenderFns:[]};var v=function(t){i("vwk+")},g=i("VU/8")(h.a,b,!1,v,null,null).exports,y={mixins:[u.a],components:{SelectPic:f,SelectText:g},computed:d()({},Object(p.b)({cpsProductType:"cpsProductType"}),{isEdit:function(){return 1==this.$route.meta.edit},isInfo:function(){return this.$route.meta.info}}),filters:{calcRecharge:function(t){var e=Number(t.accept_rule.recharge);if(0==e)return"不限";var i="";if(1==t.product_type)i=1==e?"已充值用户":"未充值用户";else if(2==t.product_type)i=1==e?"会员用户":"普通用户";else if(3==t.product_type)switch(e){case 1:i="美图充值小说充值";break;case 2:i="美图充值小说未充值";break;case 3:i="美图未充值小说充值";break;case 4:i="美图未充值小说未充值"}return console.log(t),i},calcTime:function(t){var e="";switch(t){case"0":e="不限";break;case"5":e="5天内";break;case"5-15":e="5-15天";break;case"30+":e="30天以上";break;case"15-30":e="15-30天"}return e},calcCoin:function(t){return 0==t?"不限":t}},data:function(){return{title_name:"",book_name:"",add:!0,content:{},user_id:"",rules:{title:[{required:!0,message:"请输入任务名称",trigger:"blur"}],send_time:[{required:!0,message:"请选择发送时间",trigger:"blur"}]},pickerOptions1:{disabledDate:function(t){var e=new Date;return t.getTime()<new Date(e.getFullYear(),e.getMonth(),e.getDate())},shortcuts:[{text:"10分钟后",onClick:function(t){var e=new Date;e.setTime(e.getTime()+6e5),t.$emit("pick",e)}},{text:"1小时后",onClick:function(t){var e=new Date;e.setTime(e.getTime()+36e5),t.$emit("pick",e)}},{text:"2小时后",onClick:function(t){var e=new Date;e.setTime(e.getTime()+72e5),t.$emit("pick",e)}}]},form:{product_type:1,pic:"",title:"",accept_scope:"0",msg_type:"img-text",send_time:"",title_id:"",activity_id:"",subtitle:"",accept_rule:{sex:"0",recharge:"0",subscribe_time:"0",coin:"0"},content_type:"",content:[],book_id:""},selectShow:!1,selectTextShow:!1,itemProductType:"",textIndex:-1}},watch:{},methods:{changeTypeFn:function(){this.form.album_id="",this.form.activity_id="",this.form.book_id="",this.form.pic="",this.form.title_id="",this.title_name="",this.form.content=[],this.form.subtitle=""},changeBindTypeFn:function(t){this.$store.commit("setProductType",t),this.changeTypeFn()},showSelectPicFn:function(){this.isInfo||(this.selectShow=!0)},editContentFn:function(t,e){var i=JSON.parse(l()(t));this.content=i,this.add=!1,this.selectTextShow=!0,this.textIndex=e},editSelectTextFn:function(){if(!this.isInfo){var t=this._.cloneDeep(this.form);t.title_id=t.title_id||"",2==this.cpsProductType?t.bind_type="picture":t.bind_type=t.content_type||"novel",t.title_name=this.title_name,this.content=t,this.add=!1,this.selectTextShow=!0}},deleteContentFn:function(t){this.form.content.splice(t,1)},addContentFn:function(){this.selectTextShow=!0,this.add=!0},getContent:function(t){if("img-text"==this.form.msg_type){var e=t.title_name,i=void 0===e?"":e,n=t.title_id,r=void 0===n?"":n,o=t.book_id,a=void 0===o?"":o,s=t.activity_id,l=void 0===s?"":s,c=t.bind_type,d=void 0===c?"":c,p=t.album_id,u=void 0===p?"":p;this.title_name=i,this.form.title_id=r,this.form.book_id=a,this.form.activity_id=l,this.form.content_type=d,this.form.album_id=u}else this.add?this.form.content.push(t):this.form.content[this.textIndex]=t},getBgImg:function(t){this.form.pic=t.pic},submitForm:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;var r=e._.cloneDeep(e.form);if(Number(new Date(r.send_time))-Date.now()<3e5)e.errorMsgFn("发送时间必须晚于当前时间5分钟");else{if(r.accept_rule=l()(r.accept_rule),"img-text"==r.msg_type){if(""==r.pic)return void n.warningMsgFn("请设置消息背景");if(""==r.title_id)return void n.warningMsgFn("请设置标题和目标");delete r.content}else{if(0==r.content.length)return void n.warningMsgFn("请设置标题和目标");var o=r.content.some(function(t){return"novel"==t.bind_type}),a=r.content.some(function(t){return"activity"==t.bind_type}),s=r.content.some(function(t){return"guide"==t.bind_type}),c=r.content.some(function(t){return"picture"==t.bind_type}),d=[];o&&d.push("novel"),a&&d.push("activity"),s&&d.push("guide"),c&&d.push("picture"),r.content_type=d.toString(),delete r.pic,delete r.title_id,r.content=l()(r.content)}if(0==r.accept_scope&&delete r.accept_rule,"send"!=i)e.isEdit?e.putCPSSmartPush(r):e.postCPSSmartPush(r);else{/^[1-9]\d*$/.test(e.user_id)?(e.isEdit&&delete r.id,r.user_id=e.user_id,e.postSmartPushSendFn(r)):e.warningMsgFn("请输入正确的测试粉丝ID")}}})},resetForm:function(t){this.$refs[t].resetFields(),this.closeSelectedTag("/CPSManage/push/delegation")},postCPSSmartPush:function(){var t=a()(r.a.mark(function t(e){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.send_time){t.next=3;break}return this.warningMsgFn("请添加发送时间"),t.abrupt("return");case 3:return t.next=5,this.$store.dispatch("postCPSSmartPush",e);case 5:200==t.sent.code&&(this.successMsgFn("添加成功"),this.resetForm("form"));case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getCPSSmartPushByID:function(){var t=a()(r.a.mark(function t(e){var i,n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("getCPSSmartPushByID",{id:e});case 2:i=t.sent,n=i.data,this.form={id:e,title:n.title,accept_scope:n.accept_scope+""||"0",send_time:n.send_time,msg_type:n.msg_type,accept_rule:n.accept_rule?JSON.parse(n.accept_rule):{},content:"text"==n.msg_type?JSON.parse(n.content):"",content_type:n.content_type||"",pic:n.pic,title_id:n.title_id,book_id:n.book_id,activity_id:n.activity_id,album_id:n.album_id,product_type:Number(n.product_type)||1,subtitle:n.subtitle},0==this.form.accept_scope&&(this.form.accept_rule={sex:"0",recharge:"0",subscribe_time:"0",coin:"0"}),this.$store.commit("setProductType",this.form.product_type),"img-text"==i.data.msg_type&&(this.title_name=i.data.cpstitle.title);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),putCPSSmartPush:function(){var t=a()(r.a.mark(function t(e){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.send_time){t.next=3;break}return this.warningMsgFn("请添加发送时间"),t.abrupt("return");case 3:return t.next=5,this.$store.dispatch("putCPSSmartPush",e);case 5:200==t.sent.code&&(this.successMsgFn("修改成功~"),this.resetForm("form"));case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),postSmartPushSendFn:function(){var t=a()(r.a.mark(function t(e){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.triggerActionsFn("postSmartPushSend",e);case 2:0==t.sent.code&&this.successMsgFn("发送成功~");case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},created:function(){this.isEdit||this.isInfo?this.getCPSSmartPushByID(this.$route.params.id):this.$store.commit("setProductType",1)}},x={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container massSend-add",class:{info:t.isInfo}},[i("div",{staticClass:"form-wrapper"},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[i("el-form-item",{attrs:{label:"任务名称",prop:"title"}},[i("el-input",{staticClass:"widthFormInput",attrs:{disabled:t.isInfo,placeholder:"请输入任务名称"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"产品种类"}},[i("el-radio-group",{on:{change:t.changeBindTypeFn},model:{value:t.form.product_type,callback:function(e){t.$set(t.form,"product_type",e)},expression:"form.product_type"}},[i("el-radio",{attrs:{label:1}},[t._v("小说")]),t._v(" "),i("el-radio",{attrs:{label:2}},[t._v("美图")]),t._v(" "),i("el-radio",{attrs:{label:3}},[t._v("小说+美图")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"消息类型"}},[t.isInfo?i("span",[t._v(t._s("img-text"==t.form.msg_type?"图文消息":"文本消息"))]):i("el-radio-group",{on:{change:t.changeTypeFn},model:{value:t.form.msg_type,callback:function(e){t.$set(t.form,"msg_type",e)},expression:"form.msg_type"}},[i("el-radio",{attrs:{label:"img-text"}},[t._v("图文消息")]),t._v(" "),i("el-radio",{attrs:{label:"text"}},[t._v("文本消息")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"消息预览"}},["img-text"==t.form.msg_type?i("div",{staticStyle:{width:"400px"}},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"pic-text-box"},[i("div",{staticClass:"link",class:{success:t.form.title_id&&0!=t.form.title_id},on:{click:t.editSelectTextFn}},[i("span",{attrs:{title:t.title_name}},[t._v(t._s(t.form.title_id&&0!=t.form.title_id?t.title_name:"设置标题和目标"))]),t._v(" "),t.form.title_id&&0!=t.form.title_id?i("span",{staticClass:"icon-wrapper"},[i("i",{staticClass:"el-icon-check"})]):t._e(),t._v(" "),i("i",{staticClass:"el-icon-edit"})]),t._v(" "),i("div",{staticClass:"pic",on:{click:t.showSelectPicFn}},[""==t.form.pic?i("i",{staticClass:"el-icon-plus"}):i("img",{attrs:{src:"https://res.shiyin.net/"+t.form.pic,alt:""}})])])])],1):t._e(),t._v(" "),"text"==t.form.msg_type?i("div",{staticStyle:{width:"400px"}},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"text-box"},[i("ul",t._l(t.form.content,function(e,n){return i("li",{key:n},[i("div",{staticClass:"text ellipse"},[t._v("\n                                        "+t._s(e.title_name)+"\n                                    ")]),t._v(" "),t.isInfo?t._e():i("div",{staticClass:"button"},[i("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(i){t.editContentFn(e,n)}}}),t._v(" "),i("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:function(e){t.deleteContentFn(n)}}})],1)])}))]),t._v(" "),t.form.content.length<8?i("div",{staticClass:"add-text"},[t.isInfo?t._e():i("el-button",{attrs:{type:"primary"},on:{click:t.addContentFn}},[t._v("添加文本")])],1):t._e()])],1):t._e()]),t._v(" "),"img-text"==t.form.msg_type?i("el-form-item",{attrs:{label:"副标题"}},[t.isInfo?i("span",[t._v(t._s(t.form.subtitle))]):i("el-input",{staticClass:"widthFormInput",attrs:{placeholder:"请输入副标题"},model:{value:t.form.subtitle,callback:function(e){t.$set(t.form,"subtitle",e)},expression:"form.subtitle"}})],1):t._e(),t._v(" "),i("el-form-item",{attrs:{label:"接受粉丝",required:""}},[t.isInfo?t._e():i("el-radio-group",{model:{value:t.form.accept_scope,callback:function(e){t.$set(t.form,"accept_scope",e)},expression:"form.accept_scope"}},[i("el-radio",{attrs:{label:"0"}},[t._v("全部用户")]),t._v(" "),i("el-radio",{attrs:{label:"1"}},[t._v("标签用户")])],1),t._v(" "),t.isInfo?i("p",[t._v("\n                    "+t._s(0==t.form.accept_scope?"全部用户":"标签用户")+"\n                ")]):t._e(),t._v(" "),1==t.form.accept_scope?i("div",{staticClass:"fans-info"},[i("div",{staticClass:"fans-info-item"},[i("label",{staticStyle:{width:"80px"}},[t._v("充值情况:")]),t._v(" "),t.isInfo?i("span",[t._v(t._s(t._f("calcRecharge")(t.form)))]):i("el-radio-group",{model:{value:t.form.accept_rule.recharge,callback:function(e){t.$set(t.form.accept_rule,"recharge",e)},expression:"form.accept_rule.recharge"}},[i("el-radio",{attrs:{label:"0"}},[t._v("不限")]),t._v(" "),i("el-radio",{attrs:{label:"1"}},[t._v(t._s(1==t.form.product_type?"已充值用户":2==t.form.product_type?"会员用户":"美图充值小说充值"))]),t._v(" "),i("el-radio",{attrs:{label:"2"}},[t._v(t._s(1==t.form.product_type?"未充值用户":2==t.form.product_type?"普通用户":"美图充值小说未充值"))]),t._v(" "),3==t.form.product_type?i("el-radio",{attrs:{label:"3"}},[t._v("美图未充值小说充值")]):t._e(),t._v(" "),3==t.form.product_type?i("el-radio",{attrs:{label:"4"}},[t._v("美图未充值小说未充值")]):t._e()],1)],1),t._v(" "),i("div",{staticClass:"fans-info-item"},[i("label",{staticStyle:{width:"80px"}},[t._v("性       别:")]),t._v(" "),t.isInfo?i("span",[t._v(t._s(0==t.form.accept_rule.sex?"不限":1==t.form.accept_rule.sex?"男":"女"))]):i("el-radio-group",{model:{value:t.form.accept_rule.sex,callback:function(e){t.$set(t.form.accept_rule,"sex",e)},expression:"form.accept_rule.sex"}},[i("el-radio",{attrs:{label:"0"}},[t._v("不限")]),t._v(" "),i("el-radio",{attrs:{label:"1"}},[t._v("男")]),t._v(" "),i("el-radio",{attrs:{label:"2"}},[t._v("女")])],1)],1),t._v(" "),i("div",{staticClass:"fans-info-item"},[i("label",{staticStyle:{width:"80px"}},[t._v("关注时间:")]),t._v(" "),t.isInfo?i("span",[t._v(t._s(t._f("calcTime")(t.form.accept_rule.subscribe_time)))]):i("el-radio-group",{model:{value:t.form.accept_rule.subscribe_time,callback:function(e){t.$set(t.form.accept_rule,"subscribe_time",e)},expression:"form.accept_rule.subscribe_time"}},[i("el-radio",{attrs:{label:"0"}},[t._v("不限")]),t._v(" "),i("el-radio",{attrs:{label:"5"}},[t._v("5天内")]),t._v(" "),i("el-radio",{attrs:{label:"5-15"}},[t._v("5-15天")]),t._v(" "),i("el-radio",{attrs:{label:"15-30"}},[t._v("15-30天")]),t._v(" "),i("el-radio",{attrs:{label:"30+"}},[t._v("30天以上")])],1)],1),t._v(" "),2!=t.cpsProductType?i("div",{staticClass:"fans-info-item"},[i("label",{staticStyle:{width:"80px"}},[t._v("剩余书币:")]),t._v(" "),t.isInfo?i("span",[t._v(t._s(t._f("calcCoin")(t.form.accept_rule.coin)))]):i("el-radio-group",{model:{value:t.form.accept_rule.coin,callback:function(e){t.$set(t.form.accept_rule,"coin",e)},expression:"form.accept_rule.coin"}},[i("el-radio",{attrs:{label:"0"}},[t._v("不限")]),t._v(" "),i("el-radio",{attrs:{label:"0-500"}},[t._v("0-500")]),t._v(" "),i("el-radio",{attrs:{label:"501-2000"}},[t._v("501-2000")]),t._v(" "),i("el-radio",{attrs:{label:"2001-5000"}},[t._v("2001-5000")])],1)],1):t._e()]):t._e()],1),t._v(" "),i("el-form-item",{attrs:{label:"发送时间",prop:"send_time"}},[i("el-date-picker",{staticStyle:{width:"400px"},attrs:{disabled:t.isInfo,type:"datetime",placeholder:"选择发送时间","value-format":"yyyy-MM-dd HH:mm:ss",prop:"send_time","picker-options":t.pickerOptions1},model:{value:t.form.send_time,callback:function(e){t.$set(t.form,"send_time",e)},expression:"form.send_time"}})],1),t._v(" "),t.isInfo?t._e():i("el-form-item",{attrs:{label:"测试粉丝ID"}},[i("div",{staticClass:"pr widthFormInput"},[i("el-input",{staticClass:"widthFormInput",attrs:{placeholder:"请输入测试粉丝ID"},model:{value:t.user_id,callback:function(e){t.user_id=e},expression:"user_id"}}),t._v(" "),i("el-button",{staticClass:"pa test-send",attrs:{type:"primary"},on:{click:function(e){t.submitForm("form","send")}}},[t._v("测试发送")])],1),t._v(" "),i("p",{staticClass:"tip"},[t._v("测试ID，与服务号有过48小时互动消息才送达")])]),t._v(" "),i("el-form-item",[t.isInfo?t._e():i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("form")}}},[t._v("提交")]),t._v(" "),i("el-button",{on:{click:function(e){t.resetForm("form")}}},[t._v(t._s(t.isInfo?"返回":"取消"))])],1)],1)],1),t._v(" "),i("select-pic",{attrs:{show:t.selectShow},on:{"update:show":function(e){t.selectShow=e},getBgImg:t.getBgImg}}),t._v(" "),i("select-text",{attrs:{type:t.form.msg_type,show:t.selectTextShow,content:t.content,add:t.add},on:{"update:show":function(e){t.selectTextShow=e},getContent:t.getContent}})],1)},staticRenderFns:[]};var F=i("VU/8")(y,x,!1,function(t){i("Rswp")},null,null);e.default=F.exports},Rswp:function(t,e,i){var n=i("1Ld1");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i("rjj0")("72a90836",n,!0)},So4r:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.select-pic .el-dialog {\n  width: 1200px;\n}\n.select-text .el-dialog {\n  width: 500px;\n}\n.img-box {\n  margin: 20px 0;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-pack: start;\n      -ms-flex-pack: start;\n          justify-content: flex-start;\n}\n.img-box li {\n    width: 180px;\n    height: 110px;\n    margin: 15px;\n    cursor: pointer;\n}\n.img-box li img {\n      display: block;\n      width: 100%;\n      height: 100%;\n      border-radius: 10px;\n}\n",""])},UgRR:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.select-pic .el-dialog {\n  width: 1200px;\n}\n.img-box {\n  margin: 20px 0;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-pack: start;\n      -ms-flex-pack: start;\n          justify-content: flex-start;\n}\n.img-box li {\n    width: 180px;\n    height: 110px;\n    margin: 15px;\n    cursor: pointer;\n}\n.img-box li img {\n      display: block;\n      width: 100%;\n      height: 100%;\n      border-radius: 10px;\n}\n",""])},"d5/r":function(t,e,i){var n=i("zMjf");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i("rjj0")("65834037",n,!0)},dSdr:function(t,e,i){"use strict";var n=i("Xxa5"),r=i.n(n),o=i("exGp"),a=i.n(o),s=i("Dd8w"),l=i.n(s),c=i("8BG5"),d=i("NYxO"),p={components:{EmojiAppend:c.a},computed:l()({},Object(d.b)({cpsProductType:"cpsProductType"})),props:{id:{default:1},active:{type:Number,default:1},appendToBody:{type:Boolean,default:!1},dialogTitle:{type:String,default:"新增文本标题"},dialogType:{type:String,default:"add"}},watch:{dialogFormVisible:function(t){t?(this.form.active=this.active,this.form.book_id=this.id||"",this.form.title=""):(this.form.title="",this.form.book_id="",this.form.id="",this.form.active=1,this.resetForm("ruleForm"))}},data:function(){return{options:[],bookList:[],selectLoading:!1,form:{id:"",active:1,title:"",book_id:""},dialogFormVisible:!1,rules:{title:[{required:!0,message:"请输入文本标题",trigger:"blur"}]}}},methods:{postCPSMaterialUpdateFn:function(){var t=a()(r.a.mark(function t(){var e;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._.cloneDeep(this.form),t.next=3,this.$store.dispatch("postCPSMaterialUpdate",e);case 3:200==t.sent.code&&(this.$message({message:"修改文本标题成功！",type:"success",duration:1500}),this.dialogFormVisible=!1);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),postCPSMaterialTextAddFn:function(){var t=a()(r.a.mark(function t(){var e,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._.cloneDeep(this.form),t.next=3,this.$store.dispatch("postCPSMaterialTextAdd",e);case 3:200==(i=t.sent).code&&(this.$message({message:"添加标题成功！",type:"success",duration:1500}),this.$emit("getTitleID",{id:i.data,title:e.title}),this.dialogFormVisible=!1);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return console.log("error submit!!"),!1;"add"==e.dialogType?e.postCPSMaterialTextAddFn():"edit"==e.dialogType&&e.postCPSMaterialUpdateFn()})},resetForm:function(t){this.dialogFormVisible=!1,this.$refs[t].resetFields()},remoteMethod:function(t){var e=this;""!==t?(this.selectLoading=!0,setTimeout(function(){e.selectLoading=!1,e.options=e.bookList.filter(function(e){return e.id.indexOf(t)>-1||e.name.indexOf(t)>-1})},200)):this.options=[]},open:function(){this.dialogFormVisible=!0},selectFaceFn:function(t){this.form.title+=t.alt}}},u={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"dialog-500",attrs:{title:t.dialogTitle,visible:t.dialogFormVisible,"append-to-body":t.appendToBody},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"ruleForm",attrs:{model:t.form,"label-width":"120px",rules:t.rules}},["add"==t.dialogType?i("el-form-item",{attrs:{label:"类型"}},[i("el-radio-group",{model:{value:t.form.active,callback:function(e){t.$set(t.form,"active",e)},expression:"form.active"}},[1==t.active?i("el-radio",{attrs:{label:1}},[t._v("通用")]):t._e(),t._v(" "),4==t.active?i("el-radio",{attrs:{label:4}},[t._v("美图")]):t._e(),t._v(" "),2==t.active?i("el-radio",{attrs:{label:2}},[t._v("活动")]):t._e(),t._v(" "),3==t.active?i("el-radio",{attrs:{label:3}},[t._v("引导")]):t._e()],1)],1):t._e(),t._v(" "),i("el-form-item",{attrs:{label:"文本标题",prop:"title"}},[i("el-input",{attrs:{placeholder:"请输入文本标题"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}},[i("div",{attrs:{slot:"append"},slot:"append"},[i("emoji-append",{on:{select:t.selectFaceFn}})],1)])],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.resetForm("ruleForm")}}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("提交")])],1)],1)},staticRenderFns:[]};var m=i("VU/8")(p,u,!1,function(t){i("d5/r")},null,null);e.a=m.exports},"vwk+":function(t,e,i){var n=i("So4r");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);i("rjj0")("4ed4c0d6",n,!0)},zMjf:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"\n.dialog-500 .el-dialog {\n  width: 500px;\n}\n",""])}});