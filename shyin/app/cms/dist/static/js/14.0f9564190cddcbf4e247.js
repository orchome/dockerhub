webpackJsonp([14],{QelU:function(e,t,s){(e.exports=s("FZ+f")(!1)).push([e.i,"\n.system-admin-edit[data-v-d0409acc]{\r\n  background-color:#fff;\n}\r\n",""])},nZoz:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("Xxa5"),a=s.n(r),i=s("exGp"),n=s.n(i),o=s("mvHQ"),l=s.n(o),u=s("Dd8w"),c=s.n(u),d=s("NYxO"),h=s("msXN"),m=s("LcTY"),f={computed:c()({},Object(d.b)({}),{isEdit:function(){return this.$route.path.indexOf("edit")>-1}}),watch:{},mixins:[h.a],data:function(){return{defaultProps:{children:"children",label:"label"},ruleForm:{name:"",desc:"",authority:[]},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],authority:[]},defaultCheckedkeys:[]}},methods:{initStatusFn:function(){var e=this.ruleForm.authority,t=this.defaultCheckedkeys;t=[],this.traverseAllListFn({data:e,fun:function(e){e.status&&!e.children&&t.push(e.id)}}),this.defaultCheckedkeys=t},traverseAllListFn:function(e){var t=this,s=e.fun||function(){};(e.data||this.ruleForm.authority).forEach(function(e){try{s(e),e.children&&e.children.length>0&&t.traverseAllListFn({fun:s,data:e.children})}catch(e){console.error(e)}})},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.getCheckedKeysFn();var s=JSON.parse(l()(t.ruleForm));s.permissions=s.authority,delete s.authority,t.isEdit?t.backendRoleUpdateFn(s):t.postBackendRoleCreateFn(s)})},getCheckedKeysFn:function(){var e=this.$refs.tree.getHalfCheckedKeys(),t=this.$refs.tree.getCheckedKeys(),s=e.concat(t),r=JSON.parse(l()(this.ruleForm.authority));this.traverseAllListFn({data:r,fun:function(e){e.status=!1,0!=s.length&&s.forEach(function(t){e.id==t&&(e.status=!0)})}}),this.ruleForm.authority=r},backendRoleUpdateFn:function(e){console.log("params",e),this.$store.dispatch("postBackendRoleUpdate",e),this.$message({type:"success",message:"修改成功"}),this.goBack()},postBackendRoleCreateFn:function(e){this.$store.dispatch("postBackendRoleCreate",e),this.$message({type:"success",message:"添加成功"}),this.goBack()},getDetailFn:function(){var e=n()(a.a.mark(function e(t){var s,r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("getBackendRoleInfo",{id:t});case 2:s=e.sent,console.log("res",s),200==s.code&&(this.ruleForm.name=s.data.name,this.ruleForm.desc=s.data.desc,this.ruleForm.id=s.data.id,s.data.permissions||(s.data.permissions=m.a),this.traverseAllListFn({data:s.data.permissions,fun:function(e){e.id=Number(e.id),"false"==e.status?e.status=!1:e.status=!0}}),this.ruleForm.authority=s.data.permissions,this.initStatusFn(),this.traverseAllListFn({data:m.a,fun:function(e){r.traverseAllListFn({data:r.defaultCheckedkeys,fun:function(t){e.id==t.id&&(e.status=!0)}})}}),this.ruleForm.authority=m.a);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),goBack:function(){this.closeSelectedTag("/systemAdmin/userAdmin")}},created:function(){this.isEdit?this.getDetailFn(this.$route.params.id):(this.ruleForm.authority=m.a,this.initStatusFn())}},p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container system-admin-edit"},[s("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{width:"500px"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[s("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"角色描述",prop:"desc"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入小说描述",rows:5,resize:"none"},model:{value:e.ruleForm.desc,callback:function(t){e.$set(e.ruleForm,"desc",t)},expression:"ruleForm.desc"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"赋予权限",prop:"authority","min-width":"120",align:"center"}},[s("el-tree",{ref:"tree",attrs:{data:e.ruleForm.authority,"show-checkbox":"","node-key":"id","default-expand-all":!0,props:e.defaultProps,"default-checked-keys":e.defaultCheckedkeys}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("提交")]),e._v(" "),s("el-button",{on:{click:function(t){e.goBack()}}},[e._v("返回")])],1)],1)],1)},staticRenderFns:[]};var F=s("VU/8")(f,p,!1,function(e){s("qfCl")},"data-v-d0409acc",null);t.default=F.exports},qfCl:function(e,t,s){var r=s("QelU");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);s("rjj0")("24459431",r,!0)}});