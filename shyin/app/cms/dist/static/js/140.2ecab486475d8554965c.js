webpackJsonp([140],{"8wHs":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("woOf"),r=t.n(i),o=t("d7EF"),a=t.n(o),s=t("Xxa5"),l=t.n(s),c=t("exGp"),d=t.n(c),u=t("Dd8w"),p=t.n(u),m=t("NYxO"),h={computed:p()({},Object(m.b)({cpsTempletFree:"cpsTempletFree",cpsBook:"cpsBook"})),watch:{dialogFormVisible:function(n){n||(this.resetForm(),this.ruleForm={book_ids:[],date:[],stime:"",etime:"",templet_id:this.$route.params.id,id:""})}},data:function(){return{options:[],loadingSelect:!1,dialogType:"add",dialogTitle:"新增限时免费",dialogFormVisible:!1,rules:{book_ids:[{required:!0,message:"请至少选择一本书",trigger:"change",type:"array"}],date:[{type:"array",required:!0,message:"请选择免费时间",trigger:"change"}]},pickerOptions:{disabledDate:function(n){return n.getTime()<Date.now()},shortcuts:[{text:"今天",onClick:function(n){n.$emit("pick",new Date)}}]},loading:!1,ruleForm:{book_ids:[],date:[],stime:"",etime:"",templet_id:this.$route.params.id,id:""},params:{page:1,templet_id:this.$route.params.id}}},created:function(){this.$store.dispatch("getCPSBook"),this.getCPSTimeFreeListFn()},methods:{deleteCPSTimeFreeDelFn:function(){var n=d()(l.a.mark(function n(e){return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("deleteCPSTimeFreeDel",{id:e});case 2:200==n.sent.code&&(this.$message({duration:1500,message:"删除成功！",type:"success"}),this.getCPSTimeFreeListFn());case 4:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}(),remoteMethod:function(n){var e=this;""!==n?(this.loadingSelect=!0,setTimeout(function(){e.loadingSelect=!1,e.options=e.cpsBook.filter(function(e){return e.id.indexOf(n)>-1||e.name.indexOf(n)>-1})},200)):this.options=[]},submitForm:function(){var n=this;this.$refs.ruleForm.validate(function(e){if(!e)return!1;var t=n._.cloneDeep(n.ruleForm);t.book_ids=t.book_ids.toString();var i=a()(t.date,2);t.stime=i[0],t.etime=i[1],delete t.date,"add"==n.dialogType?n.postCPSTimeFreeCreateFn(t):n.postCPSTimeFreeUpdateFn(t)})},resetForm:function(){this.$refs.ruleForm.resetFields()},addFn:function(){this.dialogTitle="新增限时免费",this.dialogType="add",this.dialogFormVisible=!0},editFn:function(n){var e=this;this.dialogTitle="编辑限时免费",this.dialogType="edit",this.options=[],this.ruleForm.book_ids=n.book_ids.split(","),this.ruleForm.id=n.id,this.ruleForm.date=[n.stime,n.etime],this.ruleForm.book_ids.forEach(function(n){var t=e.cpsBook.find(function(e){return e.id==n});t&&e.options.push({id:t.id,name:t.name})}),this.dialogFormVisible=!0},postCPSTimeFreeCreateFn:function(){var n=d()(l.a.mark(function n(e){return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("postCPSTimeFreeCreate",e);case 2:200==n.sent.code&&(this.$message({duration:1500,message:"添加成功！",type:"success"}),this.getCPSTimeFreeListFn(),this.dialogFormVisible=!1);case 4:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}(),postCPSTimeFreeUpdateFn:function(){var n=d()(l.a.mark(function n(e){return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("postCPSTimeFreeUpdate",e);case 2:200==n.sent.code&&(this.$message({duration:1500,message:"编辑成功！",type:"success"}),this.getCPSTimeFreeListFn(),this.dialogFormVisible=!1);case 4:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}(),getCPSTimeFreeListFn:function(){var n=d()(l.a.mark(function n(){var e;return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.loading=!0,e={},r()(e,this.params),n.next=5,this.$store.dispatch("getCPSTimeFreeList",e);case 5:this.loading=!1;case 6:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),handleCurrentChange:function(n){this.params.page=n,this.getCPSTimeFreeListFn()}}},f={render:function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"bar clearfix"},[t("div",{staticClass:"float-right"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini"},on:{click:n.addFn}},[n._v("新增")])],1)]),n._v(" "),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:n.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:n.cpsTempletFree.data,border:"",stripe:""}},[t("el-table-column",{attrs:{prop:"id",label:"ID","min-width":"80",fixed:""}}),n._v(" "),t("el-table-column",{attrs:{prop:"book_ids",label:"绑定书籍ID","min-width":"150","show-overflow-tooltip":""}}),n._v(" "),t("el-table-column",{attrs:{label:"有效期","min-width":"120"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("div",{attrs:{center:""}},[t("p",[n._v("起："+n._s(e.row.stime))]),n._v(" "),t("p",[n._v("终："+n._s(e.row.etime))])])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"_state",label:"状态","min-width":"120"},scopedSlots:n._u([{key:"default",fn:function(e){return[1==e.row.state?t("el-tag",[n._v("待开始")]):2==e.row.state?t("el-tag",{attrs:{type:"success"}},[n._v("已开始")]):t("el-tag",{attrs:{type:"info"}},[n._v("已结束")])]}}])}),n._v(" "),t("el-table-column",{attrs:{prop:"created_at",label:"创建时间","min-width":"120"}}),n._v(" "),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:n._u([{key:"default",fn:function(e){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){n.editFn(e.row)}}},[n._v("编辑")]),n._v(" "),t("el-popover",{attrs:{placement:"top",width:"100"},model:{value:e.row.delete,callback:function(t){n.$set(e.row,"delete",t)},expression:"scope.row.delete"}},[t("p",[n._v("确认删除选择的内容？")]),n._v(" "),t("div",{staticStyle:{"text-align":"right",margin:"0"}},[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(n){e.row.delete=!1}}},[n._v("取消")]),n._v(" "),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){n.deleteCPSTimeFreeDelFn(e.row.id),e.row.delete=!1}}},[n._v("确定")])],1),n._v(" "),t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},on:{click:function(n){e.row.delete=!0}},slot:"reference"},[n._v("删除")])],1)]}}])})],1),n._v(" "),t("div",{staticClass:"pagination-container clearfix"},[t("div",{staticClass:"float-left"},[t("global-pagination",{attrs:{"current-page":n.params.page,"page-size":n.params.per_page,layout:"total, sizes, prev, pager, next, jumper",total:n.cpsTempletFree.total},on:{"current-change":n.handleCurrentChange,"size-change":n.handleSizeChange}})],1)]),n._v(" "),t("el-dialog",{attrs:{title:n.dialogTitle,visible:n.dialogFormVisible,"close-on-click-modal":!1},on:{"update:visible":function(e){n.dialogFormVisible=e}}},[t("el-form",{ref:"ruleForm",attrs:{model:n.ruleForm,rules:n.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"选择小说",prop:"book_ids"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入小说名称/小说ID","reserve-keyword":"",multiple:"",filterable:"",remote:"","remote-method":n.remoteMethod,loading:n.loadingSelect},model:{value:n.ruleForm.book_ids,callback:function(e){n.$set(n.ruleForm,"book_ids",e)},expression:"ruleForm.book_ids"}},n._l(n.options,function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[t("span",{staticStyle:{float:"left"}},[n._v(n._s(e.id))]),n._v(" "),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[n._v(n._s(e.name))])])}))],1),n._v(" "),t("el-form-item",{attrs:{label:"免费时间",prop:"date"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:n.changeFn},model:{value:n.ruleForm.date,callback:function(e){n.$set(n.ruleForm,"date",e)},expression:"ruleForm.date"}})],1)],1),n._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(e){n.dialogFormVisible=!1}}},[n._v("取 消")]),n._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(e){n.submitForm()}}},[n._v("提交")])],1)],1)],1)},staticRenderFns:[]};var g=t("VU/8")(h,f,!1,function(n){t("KO+D")},null,null);e.default=g.exports},"KO+D":function(n,e,t){var i=t("oPvH");"string"==typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);t("rjj0")("24c94a86",i,!0)},oPvH:function(n,e,t){(n.exports=t("FZ+f")(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])}});