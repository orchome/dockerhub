webpackJsonp([25],{"3+xd":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("mvHQ"),i=t.n(r),o=t("Xxa5"),a=t.n(o),s=t("exGp"),l=t.n(s),c=t("RRo+"),u=t.n(c),p=t("//Fk"),d=t.n(p),m=t("BO1k"),f=t.n(m),b=t("Dd8w"),h=t.n(b),g=t("NYxO"),x=t("0xDb"),v={computed:h()({qiniuUpload:function(){return"http://up.qiniu.com"},qiniuHost:function(){return"http://res.shiyin.net/"},isEdit:function(){return this.$route.fullPath.indexOf("/edit/")>-1}},Object(g.b)({cpsBook:"cpsBook"})),watch:{},data:function(){return{loading:!1,options:[],uploadData:{},uploadIndex:0,uploadAcceptType:"image/jpeg,image/png",loadingSelect:!1,ruleForm:{templet_no:"1",type:"1",name:"",choice_ids:[],fbook_ids:[],editor_recomment_ids:[],banner:[{pic:"",url:"",sort:""}]},rules:{name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],choice_ids:[{type:"array",required:!0,message:"请至少选择一本书籍",trigger:"change"}],fbook_ids:[{type:"array",required:!0,message:"请至少选择一本书籍",trigger:"change"}],editor_recomment_ids:[{type:"array",required:!0,message:"请至少选择一本书籍",trigger:"change"}]}}},created:function(){var e=this;this.isEdit?this.$store.dispatch("getCPSBook").then(function(){e.getCPSTempletInfo(e.$route.params.id)}):this.$store.dispatch("getCPSBook")},methods:{checkAllFn:function(e){var n=!0,t=!0,r=!1,i=void 0;try{for(var o,a=f()(e);!(t=(o=a.next()).done);t=!0){var s=o.value;if(""==s.pic||""==s.url||""==s.pic){n=!1;break}}}catch(e){r=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw i}}return n},bannerRestFn:function(e){this.ruleForm.banner[e].pic="",this.ruleForm.banner[e].url="",this.ruleForm.banner[e].sort=""},checkNumber:function(e){return new d.a(function(n){n(!u()(Number(e)))})},blurSortFn:function(){var e=l()(a.a.mark(function e(n){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ruleForm.banner[n].sort,e.next=3,this.checkNumber(t);case 3:e.sent&&(this.warningMsgFn("请输入不小于0的排序"),this.ruleForm.banner[n].sort="");case 5:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),blurUrlFn:function(e){var n=this.ruleForm.banner[e].url;n&&!Object(x.b)(n)&&(this.warningMsgFn("请输入正确的URL链接"),this.ruleForm.banner[e].url="")},blurIdFn:function(e){""==this.ruleForm.banner[e].url&&this.warningMsgFn("请输入正确的书籍ID")},handleBannerSuccess:function(e){this.ruleForm.banner[this.uploadIndex].pic=e.key},openUploadFn:function(e){this.uploadIndex=e,document.querySelector(".banner-uploader input").click()},beforeBannerUpload:function(){var e=l()(a.a.mark(function e(n){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.size/1024<=100){e.next=7;break}return this.$message.error("上传banner大小不能超过100KB!"),this.uploadData.token="",e.abrupt("return",!1);case 7:return e.next=9,this.$store.dispatch("getQiniuToken");case 9:if(200!=(t=e.sent).code){e.next=15;break}return this.uploadData={token:t.token},e.abrupt("return",!0);case 15:return this.uploadData.token="",e.abrupt("return",!1);case 17:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),addBannerFn:function(){this.ruleForm.banner.push({pic:"",sort:"",url:""})},submitForm:function(){var e=this;this.$refs.ruleForm.validate(function(n){if(!n)return console.log("error submit!!"),!1;if(e.checkAllFn(e.ruleForm.banner)){e.loading=!0;var t=e._.cloneDeep(e.ruleForm);t.editor_recomment_ids=t.editor_recomment_ids.toString(),t.fbook_ids=t.fbook_ids.toString(),t.choice_ids=t.choice_ids.toString(),t.banner=i()(t.banner),e.isEdit?e.postCPSTempletUpdateFn(t):e.postCPSTempletCreateFn(t)}else e.warningMsgFn("请检查顶部banner是否有为空数据！")})},resetForm:function(){var e=this;this.ruleForm.banner=[{pic:"",url:"",sort:""}],this.$refs.ruleForm.resetFields(),this.$store.dispatch("getCPSTempletList",{page:1}),setTimeout(function(){e.closeSelectedTag("/CPSManage/template")},500)},remoteMethod:function(e){var n=this;""!==e?(this.loadingSelect=!0,setTimeout(function(){n.loadingSelect=!1,n.options=n.cpsBook.filter(function(n){return n.id.indexOf(e)>-1||n.name.indexOf(e)>-1})},200)):this.options=[]},postCPSTempletCreateFn:function(){var e=l()(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("postCPSTempletCreate",n);case 2:200==e.sent.code&&(this.successMsgFn("添加模板成功~"),this.resetForm(),this.loading=!1);case 4:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),postCPSTempletUpdateFn:function(){var e=l()(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("postCPSTempletUpdate",n);case 2:200==e.sent.code&&(this.successMsgFn("修改模板成功~"),this.resetForm(),this.loading=!1);case 4:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),getCPSTempletInfo:function(){var e=l()(a.a.mark(function e(n){var t,r,i,o,s,l,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("getCPSTempletInfo",{id:n});case 2:200==(t=e.sent).code&&(r=this._.cloneDeep(t.data),i=this.pushBookIdFn(r.choice_ids.split(",")),o=this.pushBookIdFn(r.fbook_ids.split(",")),s=this.pushBookIdFn(r.editor_recomment_ids.split(",")),l=i.concat(o).concat(s),c=[],l.forEach(function(e){-1==c.findIndex(function(n){return n.id==e.id})&&c.push(e)}),this.options=c,this.ruleForm={id:t.data.id,type:t.data.type+"",name:t.data.name,choice_ids:t.data.choice_ids.split(","),fbook_ids:t.data.fbook_ids.split(","),editor_recomment_ids:t.data.editor_recomment_ids.split(","),banner:JSON.parse(t.data.banner),templet_no:t.data.templet_no+""});case 4:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),pushBookIdFn:function(e){var n=this,t=[];return e.forEach(function(e){var r=n.cpsBook.find(function(n){return n.id==e});r&&t.push({id:r.id+"",name:r.name})}),t},removeBannerFn:function(e){this.ruleForm.banner.splice(e,1)}}},_={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"app-container"},[t("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-width":"80px",rules:e.rules}},[t("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"模板类型"}},[t("el-radio-group",{model:{value:e.ruleForm.type,callback:function(n){e.$set(e.ruleForm,"type",n)},expression:"ruleForm.type"}},[t("el-radio",{attrs:{label:"1"}},[e._v("男生")]),e._v(" "),t("el-radio",{attrs:{label:"2"}},[e._v("女生")])],1)],1),e._v(" "),t("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"模板样式"}},[t("el-radio-group",{model:{value:e.ruleForm.templet_no,callback:function(n){e.$set(e.ruleForm,"templet_no",n)},expression:"ruleForm.templet_no"}},[t("el-radio",{attrs:{label:"1"}},[e._v("模板1")]),e._v(" "),t("el-radio",{attrs:{label:"2"}},[e._v("模板2")])],1)],1),e._v(" "),t("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"模板名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入模板名称"},model:{value:e.ruleForm.name,callback:function(n){e.$set(e.ruleForm,"name",n)},expression:"ruleForm.name"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"顶部banner"}},[t("ul",{staticClass:"banner-wrap"},[e._l(e.ruleForm.banner,function(n,r){return t("li",{key:r,staticClass:"banner-size banner"},[t("div",{staticClass:"banner-left"},[""!==n.pic?t("img",{attrs:{src:e.qiniuHost+n.pic,alt:""}}):t("div",{staticClass:"banner-upload",on:{click:function(n){e.openUploadFn(r)}}},[t("i",{staticClass:"el-icon-plus banner-uploader-icon"})])]),e._v(" "),t("div",{staticClass:"banner-right"},[t("div",{staticClass:"banner-url"},[t("label",[e._v("书籍ID：")]),t("input",{directives:[{name:"model",rawName:"v-model.trim",value:n.url,expression:"banner.url",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:n.url},on:{blur:[function(n){e.blurIdFn(r)},function(n){e.$forceUpdate()}],input:function(t){t.target.composing||e.$set(n,"url",t.target.value.trim())}}})]),e._v(" "),t("div",{staticClass:"banner-sort"},[t("div",[t("label",[e._v("排序：")]),t("input",{directives:[{name:"model",rawName:"v-model",value:n.sort,expression:"banner.sort"}],attrs:{type:"text"},domProps:{value:n.sort},on:{blur:function(n){e.blurSortFn(r)},input:function(t){t.target.composing||e.$set(n,"sort",t.target.value)}}})]),e._v(" "),t("span",{staticClass:"banner-reset",attrs:{type:"primary"},on:{click:function(n){e.bannerRestFn(r)}}},[e._v("重置")])])]),e._v(" "),t("span",{staticClass:"close",on:{click:function(n){e.removeBannerFn(r)}}},[t("i",{staticClass:"el-icon-circle-close-outline close-icon"})])])}),e._v(" "),t("li",{directives:[{name:"show",rawName:"v-show",value:e.ruleForm.banner.length<5,expression:"ruleForm.banner.length < 5"}],staticClass:"add-banner banner-size"},[t("span",{on:{click:e.addBannerFn}},[t("i",{staticClass:"el-icon-plus"}),e._v("添加一个banner")]),e._v(" "),t("span",[e._v("建议尺寸为750X299像素")])])],2)]),e._v(" "),t("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"主编推荐",prop:"editor_recomment_ids"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入小说名称/小说ID",multiple:"",filterable:"",remote:"","remote-method":e.remoteMethod,loading:e.loadingSelect},model:{value:e.ruleForm.editor_recomment_ids,callback:function(n){e.$set(e.ruleForm,"editor_recomment_ids",n)},expression:"ruleForm.editor_recomment_ids"}},e._l(e.options,function(n){return t("el-option",{key:n.id,attrs:{label:n.name,value:n.id}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(n.id))]),e._v(" "),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(n.name))])])}))],1),e._v(" "),t("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"发现好书",prop:"fbook_ids"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入小说名称/小说ID",multiple:"",filterable:"",remote:"","remote-method":e.remoteMethod,loading:e.loadingSelect},model:{value:e.ruleForm.fbook_ids,callback:function(n){e.$set(e.ruleForm,"fbook_ids",n)},expression:"ruleForm.fbook_ids"}},e._l(e.options,function(n){return t("el-option",{key:n.id,attrs:{label:n.name,value:n.id}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(n.id))]),e._v(" "),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(n.name))])])}))],1),e._v(" "),t("el-form-item",{staticStyle:{width:"500px"},attrs:{label:1==e.ruleForm.type?"男生精选":"女生精选",prop:"choice_ids"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入小说名称/小说ID",multiple:"",filterable:"",remote:"","remote-method":e.remoteMethod,loading:e.loadingSelect},model:{value:e.ruleForm.choice_ids,callback:function(n){e.$set(e.ruleForm,"choice_ids",n)},expression:"ruleForm.choice_ids"}},e._l(e.options,function(n){return t("el-option",{key:n.id,attrs:{label:n.name,value:n.id}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(n.id))]),e._v(" "),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(n.name))])])}))],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(n){e.submitForm()}}},[e._v("保存并发布")]),e._v(" "),t("el-button",{on:{click:function(n){e.resetForm()}}},[e._v("取消")])],1)],1),e._v(" "),t("el-upload",{staticClass:"banner-uploader",attrs:{action:e.qiniuUpload,"show-file-list":!1,accept:e.uploadAcceptType,"on-success":e.handleBannerSuccess,data:e.uploadData,"before-upload":e.beforeBannerUpload}})],1)},staticRenderFns:[]};var k=t("VU/8")(v,_,!1,function(e){t("316g")},null,null);n.default=k.exports},"316g":function(e,n,t){var r=t("4fLL");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);t("rjj0")("2670659c",r,!0)},"4fLL":function(e,n,t){(e.exports=t("FZ+f")(!1)).push([e.i,"\n.banner-wrap {\r\n    margin: 0;\r\n    padding: 0;\r\n    width: 100%;\r\n    display: -webkit-box;\r\n    display: -ms-flexbox;\r\n    display: flex;\r\n    -ms-flex-wrap: wrap;\r\n        flex-wrap: wrap;\r\n    list-style: none;\n}\n.banner-wrap li {\r\n    margin-bottom: 10px;\r\n    list-style: none;\r\n    margin-right: 10px;\n}\n.banner-size {\r\n    width: 375px;\r\n    height: 150px;\r\n    -webkit-box-sizing: border-box;\r\n            box-sizing: border-box;\r\n    border: 1px solid rgb(121, 121, 121);\n}\n.add-banner {\r\n    display: -webkit-box;\r\n    display: -ms-flexbox;\r\n    display: flex;\r\n    -webkit-box-orient: vertical;\r\n    -webkit-box-direction: normal;\r\n        -ms-flex-direction: column;\r\n            flex-direction: column;\r\n    -webkit-box-align: center;\r\n        -ms-flex-align: center;\r\n            align-items: center;\r\n    -webkit-box-pack: center;\r\n        -ms-flex-pack: center;\r\n            justify-content: center;\n}\n.add-banner span:first-child {\r\n    color: rgb(0, 0, 255);\r\n    font-size: 14px;\r\n    cursor: pointer;\n}\n.add-banner span:first-child:hover {\r\n    color: #409eff;\n}\n.add-banner span:last-child {\r\n    color: rgb(148, 148, 148);\r\n    font-size: 12px;\n}\n.banner-right {\r\n    font-size: 12px;\r\n    color: #333;\n}\n.banner-left {\r\n    width: 120px;\r\n    height: 120px;\n}\n.banner-left img {\r\n    width: 120px;\r\n    height: 120px;\n}\n.banner {\r\n    display: -webkit-box;\r\n    display: -ms-flexbox;\r\n    display: flex;\r\n    -webkit-box-align: center;\r\n        -ms-flex-align: center;\r\n            align-items: center;\r\n    -ms-flex-pack: distribute;\r\n        justify-content: space-around;\r\n    position: relative;\n}\n.close {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 0;\r\n    display: none;\r\n    font-size: 18px;\r\n    -webkit-transform: translate(50%, -50%);\r\n            transform: translate(50%, -50%);\n}\n.banner:hover .close {\r\n    display: block;\n}\n.close-icon {\r\n    background: #fff;\r\n    cursor: pointer;\n}\n.banner-sort {\r\n    display: -webkit-box;\r\n    display: -ms-flexbox;\r\n    display: flex;\r\n    -webkit-box-pack: justify;\r\n        -ms-flex-pack: justify;\r\n            justify-content: space-between;\r\n    -webkit-box-align: center;\r\n        -ms-flex-align: center;\r\n            align-items: center;\n}\n.banner-sort input {\r\n    width: 40px;\n}\n.banner-reset {\r\n    height: 20px;\r\n    line-height: 20px;\r\n    display: inline-block;\r\n    background: #409eff;\r\n    color: #fff;\r\n    width: 40px;\r\n    border-radius: 4px;\r\n    text-align: center;\r\n    cursor: pointer;\n}\n.banner-reset:hover {\r\n    background: #66b1ff;\n}\n.banner-upload {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n    height: 100%;\n}\n.banner-uploader-icon {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 120px;\r\n    height: 120px;\r\n    line-height: 120px;\r\n    text-align: center;\n}\r\n",""])}});