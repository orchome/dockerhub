webpackJsonp([50],{H2vY:function(n,t,e){var r=e("eGar");"string"==typeof r&&(r=[[n.i,r,""]]),r.locals&&(n.exports=r.locals);e("rjj0")("b2554574",r,!0)},eGar:function(n,t,e){(n.exports=e("FZ+f")(!1)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},"jt+i":function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=e("//Fk"),o=e.n(r),a=e("Xxa5"),s=e.n(a),i=e("exGp"),l=e.n(i),u=e("RRo+"),c=e.n(u),d=e("Dd8w"),p=e.n(d),m=e("NYxO"),h=e("0xDb"),f={mixins:[e("msXN").a],computed:p()({sensitiveAll:function(){return this.sensitiveContent.concat(this.sensitiveAuthor)},isEdit:function(){return this.$route.fullPath.indexOf("/edit/")>-1},wordCountColor:function(){return this.ruleForm.word_count<1?"#F56C6C":"#67C23A"}},Object(m.b)({allVolume:"allVolume"})),watch:{ruleForm:{handler:function(n){this.ruleForm.word_count=Object(h.g)(n.content)},deep:!0}},data:function(){var n=this;return{isTimingSend:!1,sensitiveAuthor:[],sensitiveContent:[],sensitiveWord:[],lastChapterSort:"该小说目前最新章节序号为0",options:[],loadingBut:!1,loading:!1,bookList:[],ruleForm:{book_id:"",name:"",volume_id:"",sort:"",content:"",word_count:0,author_word:"",insert_status:0},rules:{name:[{required:!0,message:"请输入18字以内的章节名称",trigger:"blur"},{min:1,max:18,message:"长度在 1 到 18 个字符",trigger:"blur"}],book_id:[{required:!0,message:"请选择小说",trigger:"change"}],sort:[{validator:function(n,t,e){if(!t&&t+""!="0")return e(new Error("请输入序号"));setTimeout(function(){c()(Number(t))?e():e(new Error("请输入数字值"))},1e3)},trigger:"blur",required:!0}],content:[{validator:function(t,e,r){e||e+""=="0"?n.ruleForm.word_count<1?r(new Error("发布至少需要1字!")):r():r(new Error("请输入章节内容"))},trigger:"blur",required:!0}]}}},methods:{calcSensitiveFn:function(n,t){var e=[],r="1"==n?"章节内容":"作者的话";this.sensitiveWord.length>0&&this.sensitiveWord.forEach(function(n){var o;(o=t.match(new RegExp(n.name,"ig")))&&o.length>0&&e.push({name:n.name,type:n.type,number:o.length,place:r})}),"2"==n?this.sensitiveAuthor=e:this.sensitiveContent=e},getBookFn:function(){var n=l()(s.a.mark(function n(t){var e;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getAjaxChapterSortFn(t);case 2:return n.next=4,this.$store.dispatch("getAjaxVolume",{book_id:t});case 4:200==(e=n.sent).code&&(this.ruleForm.volume_id=e.data[e.data.length-1].id);case 6:case"end":return n.stop()}},n,this)}));return function(t){return n.apply(this,arguments)}}(),getAjaxChapterSortFn:function(){var n=l()(s.a.mark(function n(t){var e,r=this;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("getAjaxChapterSort",{book_id:t});case 2:return e=n.sent,n.abrupt("return",new o.a(function(n){200==e.code&&e.data?r.lastChapterSort=e.data:(r.lastChapterSort="该小说目前最新章节序号为"+e.data,r.ruleForm.sort=0),n()}));case 4:case"end":return n.stop()}},n,this)}));return function(t){return n.apply(this,arguments)}}(),remoteMethod:function(n){var t=this;""!==n?(this.loading=!0,setTimeout(function(){t.loading=!1,t.options=t.bookList.filter(function(t){return t.id.indexOf(n)>-1||t.name.indexOf(n)>-1})},200)):this.options=[]},getAjaxGetBookFn:function(){var n=l()(s.a.mark(function n(){var t;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("getAjaxGetBook");case 2:200==(t=n.sent).code&&(t.data.forEach(function(n){return n.id=n.id+""}),this.bookList=t.data);case 4:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),submitForm:function(n){var t=this;this.$refs[n].validate(function(n){if(!n)return t.loadingBut=!1,!1;t.loadingBut=!0,t.isEdit?t.postChapterUpdate():t.postChapterCreateFn()})},resetForm:function(n){this.$refs[n].resetFields(),this.closeSelectedTag("/novelManage/chapter")},postChapterCreateFn:function(){var n=l()(s.a.mark(function n(){var t;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return delete(t=this._.cloneDeep(this.ruleForm)).insert_status,n.next=4,this.$store.dispatch("postChapterCreate",t);case 4:200==n.sent.code&&(this.resetForm("ruleForm"),this.$message({duration:1500,message:"添加章节成功！",type:"success"}),this.$router.push("/novelManage/chapter")),this.loadingBut=!1;case 7:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),getChapterInfoFn:function(){var n=l()(s.a.mark(function n(t){var e;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("getChapterInfo",{id:t});case 2:if(200!=(e=n.sent).code){n.next=9;break}return this.options=[{id:e.data.book_id,name:e.data.book_name}],n.next=7,this.getBookFn(e.data.book_id);case 7:this.ruleForm={id:e.data.id,book_id:e.data.book_id,name:e.data.name,volume_id:e.data.volume_id+"",sort:e.data.sort,content:e.data.content,word_count:e.data.word_count,author_word:e.data.author_word,insert_status:e.data.insert_status||0,status:e.data.status+""},this.isTimingSend=10==e.data.status;case 9:case"end":return n.stop()}},n,this)}));return function(t){return n.apply(this,arguments)}}(),postChapterUpdate:function(){var n=l()(s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("postChapterUpdate",this.ruleForm);case 2:200==n.sent.code&&(this.resetForm("ruleForm"),this.$message({duration:1500,message:"修改章节成功！",type:"success"}),this.$router.push("/novelManage/chapter")),this.loadingBut=!1;case 5:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}(),getAllWordFn:function(){var n=l()(s.a.mark(function n(){var t;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.$store.dispatch("getAllWord");case 2:200==(t=n.sent).code&&(this.sensitiveWord=t.data);case 4:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}()},created:function(){var n=l()(s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:this.getAllWordFn(),this.isEdit?this.getChapterInfoFn(this.$route.params.id):this.getAjaxGetBookFn();case 2:case"end":return n.stop()}},n,this)}));return function(){return n.apply(this,arguments)}}()},v={render:function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"app-container"},[e("div",[e("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:n.ruleForm,rules:n.rules,"label-width":"100px"}},[e("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"章节名称",prop:"name"}},[e("el-input",{attrs:{placeholder:"请输入章节名称"},model:{value:n.ruleForm.name,callback:function(t){n.$set(n.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),n._v(" "),e("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"小说名称",prop:"book_id"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入小说名称",filterable:"",remote:"","remote-method":n.remoteMethod,loading:n.loading},on:{change:n.getBookFn},model:{value:n.ruleForm.book_id,callback:function(t){n.$set(n.ruleForm,"book_id",t)},expression:"ruleForm.book_id"}},n._l(n.options,function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[e("span",{staticStyle:{float:"left"}},[n._v(n._s(t.id))]),n._v(" "),e("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[n._v(n._s(t.name))])])}))],1),n._v(" "),e("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"卷轴名称",prop:"volume_id"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择卷轴"},model:{value:n.ruleForm.volume_id,callback:function(t){n.$set(n.ruleForm,"volume_id",t)},expression:"ruleForm.volume_id"}},n._l(n.allVolume,function(n){return e("el-option",{key:n.id,attrs:{label:n.name,value:n.id}})}))],1),n._v(" "),e("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"排序",prop:"sort"}},[e("div",{staticStyle:{position:"relative"}},[e("el-input",{attrs:{placeholder:"请输入卷轴序号"},model:{value:n.ruleForm.sort,callback:function(t){n.$set(n.ruleForm,"sort",t)},expression:"ruleForm.sort"}}),n._v(" "),e("span",{staticStyle:{position:"absolute",right:"-10px",transform:"translate(100%,-50%)",top:"50%",color:"rgba(0,0,0,0.5)"}},[n._v(n._s(n.lastChapterSort))])],1)]),n._v(" "),n.isEdit?e("el-form-item",{attrs:{label:"插入章节"}},[e("el-radio-group",{model:{value:n.ruleForm.insert_status,callback:function(t){n.$set(n.ruleForm,"insert_status",t)},expression:"ruleForm.insert_status"}},[e("el-radio",{attrs:{label:1}},[n._v("是")]),n._v(" "),e("el-radio",{attrs:{label:0}},[n._v("否")])],1)],1):n._e(),n._v(" "),n.isEdit?e("el-form-item",{attrs:{label:"章节状态"}},[e("el-radio-group",{model:{value:n.ruleForm.status,callback:function(t){n.$set(n.ruleForm,"status",t)},expression:"ruleForm.status"}},[e("el-radio",{attrs:{label:"0"}},[n._v("草稿箱")]),n._v(" "),e("el-radio",{attrs:{label:"1"}},[n._v("审核中")]),n._v(" "),e("el-radio",{attrs:{label:"2"}},[n._v("发布")]),n._v(" "),e("el-radio",{attrs:{label:"3"}},[n._v("审核未通过")]),n._v(" "),e("el-radio",{attrs:{label:"4"}},[n._v("回收站")]),n._v(" "),e("el-radio",{attrs:{label:"10",disabled:!n.isTimingSend}},[n._v("定时发布")])],1)],1):n._e(),n._v(" "),e("el-form-item",{staticStyle:{"min-width":"500px"},attrs:{label:"章节内容",prop:"content"}},[e("div",{staticStyle:{position:"relative"}},[e("el-input",{attrs:{type:"textarea",rows:20,resize:"none"},on:{change:function(t){n.calcSensitiveFn(1,t)}},model:{value:n.ruleForm.content,callback:function(t){n.$set(n.ruleForm,"content",t)},expression:"ruleForm.content"}}),n._v(" "),e("span",{staticStyle:{position:"absolute",right:"0"}},[n._v("\n            当前字数共\n            "),e("span",{style:"color:"+n.wordCountColor},[n._v(n._s(n.ruleForm.word_count))]),n._v("字\n          ")])],1)]),n._v(" "),n.isEdit?e("el-form-item",{staticStyle:{"min-width":"500px","margin-top":"30px"},attrs:{label:"作者的话"}},[e("el-input",{attrs:{type:"textarea",rows:5,resize:"none"},on:{change:function(t){n.calcSensitiveFn(2,t)}},model:{value:n.ruleForm.author_word,callback:function(t){n.$set(n.ruleForm,"author_word",t)},expression:"ruleForm.author_word"}})],1):n._e(),n._v(" "),e("el-form-item",{attrs:{label:"敏感词"}},[e("el-table",{staticStyle:{width:"600px"},attrs:{data:n.sensitiveAll,border:"","empty-text":"暂未发现敏感词"}},[e("el-table-column",{attrs:{prop:"name",label:"敏感词",width:"180"},scopedSlots:n._u([{key:"default",fn:function(t){return[e("span",{staticStyle:{"font-weight":"900","font-size":"16px"}},[n._v(n._s(t.row.name))])]}}])}),n._v(" "),e("el-table-column",{attrs:{prop:"type",label:"级别",width:"180"},scopedSlots:n._u([{key:"default",fn:function(t){return["1"==t.row.type?e("el-tag",{attrs:{type:"danger"}},[n._v("一级敏感词")]):e("el-tag",{attrs:{type:"warning"}},[n._v("二级敏感词")])]}}])}),n._v(" "),e("el-table-column",{attrs:{prop:"number",label:"出现次数"}}),n._v(" "),e("el-table-column",{attrs:{prop:"place",label:"出现位置"}})],1)],1),n._v(" "),e("el-form-item",[e("el-button",{attrs:{type:"primary",loading:n.loadingBut},on:{click:function(t){n.submitForm("ruleForm")}}},[n._v("提交")]),n._v(" "),e("el-button",{on:{click:function(t){n.resetForm("ruleForm")}}},[n._v("返回")])],1)],1)],1)])},staticRenderFns:[]};var _=e("VU/8")(f,v,!1,function(n){e("H2vY")},null,null);t.default=_.exports}});